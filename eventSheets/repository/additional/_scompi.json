{
	"name": "_scompi",
	"events": [
		{
			"eventType": "comment",
			"text": "план АРХИТЕКТУРЫ SCOMPI_BRAIN (Лист _scompi) \n\n\"Scompi_Brain\" — это стейт-машина (Finite State Machine), управляющая поведением питомца. Лист разбивается на логические группы, которые включаются/выключаются (set-group-active) для экономии ресурсов и изоляции логики.\n\n[ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ СКОМПИ]\n- sHunger (number): 0-100. Растет по таймеру.\n- sState (string): \"chill\", \"hungry\", \"naughty\" (проказит), \"crazy\" (100% голода), \"eating\", \"dialogue\".\n- sLoc (string): \"bit\" (на плече), \"inv\" (в ячейке), \"far_inv\" (в конце инвентаря для дразнения), \"map\" (навигатор).\n- sIsBusy (boolean): флаг, запрещающий Биту использовать Скомпи как способность (например, если Скомпи сейчас жрет инвентарь, им нельзя атаковать).\n\n[ГРУППА: Scompi_Tick (Всегда активна)]\n- Отвечает за инкремент голода (каждые X секунд).\n- Проверяет пороги `sHunger`:\n  - > 50%: Меняет анимацию на \"показывает в рот\" (если `sState` == \"chill\").\n  - > 80%: Меняет `sState` на \"naughty\". Запускает сигнал вторжения в инвентарь (сдвиг предметов).\n  - == 100%: Запускает \"Критический голод\" (проверка наличия еды и выбор сценария).\n\n[ГРУППА: Scompi_Inventory_Logic (Включается когда sLoc == \"inv\")]\n- Переопределяет логику сортировки. Скомпи заставляет функцию `cellN` (лист _UI) игнорировать его обычный UID и жестко ставит себе `cellN = 1` (если голоден) или `cellN = 2` (если просто отдыхает).\n- Обрабатывает Drag&Drop: если на Скомпи бросают предмет (`on-drop` предмет на Скомпи), запускается анимация жевания, `sHunger` сбрасывается, с 20% шансом генерируется семечко (через `getItem`).\n\n[ГРУППА: Scompi_Critical (Срабатывает при sHunger == 100)]\n- Функция `scompiCheckFood`: проверяет словарь `itemsQ`.\n  - СЦЕНАРИЙ 1 (Еда есть): \n    1. Перехват управления (блокировка кликов).\n    2. Сигнал закрытия инвентаря.\n    3. Экранная тряска (плагин Shake или Tween позиции камеры).\n    4. Цикл `for-each-key` в `itemsQ` — обнуление съедобных ключей.\n    5. Сигнал открытия инвентаря: Скомпи сидит толстый и довольный (`sState` = \"fat_chill\").\n  - СЦЕНАРИЙ 2 (Еды нет):\n    1. Скомпи переходит в `sState` = \"crazy\" (глаза-спирали).\n    2. Вызывает кастомный триггер: либо зомби-режим (блокирует первую ячейку и спамит звуками), либо агрессия на Бита (вызывает функцию респауна / вмешательство Сова).\n"
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-start-of-layout",
					"objectClass": "System",
					"sid": 760233027331312
				},
				{
					"id": "compare-two-values",
					"objectClass": "System",
					"sid": 130512734991940,
					"parameters": {
						"first-value": "LayoutName",
						"comparison": 1,
						"second-value": "\"start\""
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "aTools",
					"sid": 406457949867026,
					"parameters": {
						"instance-variable": "n",
						"comparison": 0,
						"value": "frame.n"
					}
				}
			],
			"actions": [
				{
					"type": "comment",
					"text": "временные действия ",
					"background-color": [
						0.996078431372549,
						0.7450980392156863,
						0.9882352941176471,
						1
					]
				},
				{
					"id": "set-group-active",
					"objectClass": "System",
					"sid": 757123439582755,
					"parameters": {
						"group-name": "\"scompi\"",
						"state": "activated"
					}
				},
				{
					"id": "set-group-active",
					"objectClass": "System",
					"sid": 222884204278939,
					"parameters": {
						"group-name": "\"uiDialogs\"",
						"state": "activated"
					}
				}
			],
			"sid": 913220744919309
		},
		{
			"eventType": "comment",
			"text": ""
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "scompi",
			"description": "",
			"isActiveOnStart": false,
			"children": [
				{
					"eventType": "comment",
					"text": "демонстрация переменных"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "trigger-once-while-true",
							"objectClass": "System",
							"sid": 191342250953718
						},
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "aScompi",
							"sid": 628728912596044,
							"parameters": {
								"instance-variable": "sIsBusy"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "aScompi",
							"sid": 804875048922323,
							"parameters": {
								"instance-variable": "sHunger",
								"comparison": 0,
								"value": "0"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "aScompi",
							"sid": 993081155724969,
							"parameters": {
								"instance-variable": "sLoc",
								"comparison": 0,
								"value": "\"Bit\""
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "aScompi",
							"sid": 776227676531029,
							"parameters": {
								"instance-variable": "sState",
								"comparison": 0,
								"value": "\"chill\""
							}
						},
						{
							"id": "is-outside-layout",
							"objectClass": "cocoFX",
							"sid": 490997827987964
						}
					],
					"actions": [],
					"sid": 432110887280293,
					"disabled": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-random-instance",
									"objectClass": "System",
									"sid": 871144908308677,
									"parameters": {
										"object": "cocoFX"
									}
								}
							],
							"actions": [
								{
									"id": "set-position",
									"objectClass": "cocoFX",
									"sid": 306663997114043,
									"parameters": {
										"x": "Mouse.X",
										"y": "Mouse.Y"
									}
								},
								{
									"id": "set-animation",
									"objectClass": "cocoFX",
									"sid": 873997607950622,
									"parameters": {
										"animation": "\"fx\"",
										"from": "beginning"
									}
								},
								{
									"id": "start-animation",
									"objectClass": "cocoFX",
									"sid": 496803085426109,
									"parameters": {
										"from": "beginning"
									}
								}
							],
							"sid": 821393340354458,
							"disabled": true
						}
					]
				},
				{
					"eventType": "comment",
					"text": ""
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "scompiBrain",
					"description": "",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "comment",
							"text": "Таймер голода Скомпи. Увеличиваем голод каждые 5 секунд (настроить по балансу)",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "every-x-seconds",
									"objectClass": "System",
									"sid": 847291048271948,
									"parameters": {
										"interval-seconds": "5.0"
									}
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "aScompi",
									"sid": 192837465019283,
									"parameters": {
										"instance-variable": "sHunger",
										"comparison": 2,
										"value": "100"
									}
								}
							],
							"actions": [
								{
									"id": "add-to-instvar",
									"objectClass": "aScompi",
									"sid": 583920184756291,
									"parameters": {
										"instance-variable": "sHunger",
										"value": "2"
									}
								}
							],
							"sid": 482910384756102
						},
						{
							"eventType": "comment",
							"text": "Ограничитель голода (Clamp 0-100)",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "aScompi",
									"sid": 572819304857192,
									"parameters": {
										"instance-variable": "sHunger",
										"comparison": 4,
										"value": "100"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "aScompi",
									"sid": 192837465102938,
									"parameters": {
										"instance-variable": "sHunger",
										"value": "100"
									}
								}
							],
							"sid": 485729103847561
						},
						{
							"eventType": "comment",
							"text": "Машина состояний (State Machine) на основе уровня голода",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "aScompi",
									"sid": 582910384756192,
									"parameters": {
										"instance-variable": "sHunger",
										"comparison": 5,
										"value": "80"
									}
								}
							],
							"actions": [],
							"sid": 384756102938475,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "aScompi",
											"sid": 102938475610293,
											"parameters": {
												"instance-variable": "sState",
												"comparison": 1,
												"value": "\"crazy\""
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "aScompi",
											"sid": 485719203847561,
											"parameters": {
												"instance-variable": "sState",
												"value": "\"crazy\""
											}
										},
										{
											"id": "signal",
											"objectClass": "System",
											"sid": 582910384756102,
											"parameters": {
												"tag": "\"scompi_crazy_start\""
											}
										}
									],
									"sid": 293847561029384
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 485719203847562
								}
							],
							"actions": [],
							"sid": 192837465019284,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "aScompi",
											"sid": 582910384756103,
											"parameters": {
												"instance-variable": "sHunger",
												"comparison": 5,
												"value": "50"
											}
										}
									],
									"actions": [],
									"sid": 384756102938476,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-instance-variable",
													"objectClass": "aScompi",
													"sid": 102938475610294,
													"parameters": {
														"instance-variable": "sState",
														"comparison": 1,
														"value": "\"hungry\""
													}
												}
											],
											"actions": [
												{
													"id": "set-instvar-value",
													"objectClass": "aScompi",
													"sid": 485719203847563,
													"parameters": {
														"instance-variable": "sState",
														"value": "\"hungry\""
													}
												},
												{
													"id": "signal",
													"objectClass": "System",
													"sid": 582910384756104,
													"parameters": {
														"tag": "\"scompi_hungry_start\""
													}
												}
											],
											"sid": 293847561029385
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 485719203847564
										}
									],
									"actions": [],
									"sid": 192837465019285,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-instance-variable",
													"objectClass": "aScompi",
													"sid": 102938475610295,
													"parameters": {
														"instance-variable": "sState",
														"comparison": 1,
														"value": "\"chill\""
													}
												}
											],
											"actions": [
												{
													"id": "set-instvar-value",
													"objectClass": "aScompi",
													"sid": 485719203847565,
													"parameters": {
														"instance-variable": "sState",
														"value": "\"chill\""
													}
												},
												{
													"id": "signal",
													"objectClass": "System",
													"sid": 582910384756105,
													"parameters": {
														"tag": "\"scompi_chill_start\""
													}
												}
											],
											"sid": 293847561029386
										}
									]
								}
							]
						}
					],
					"sid": 839201847561029
				},
				{
					"eventType": "comment",
					"text": ""
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "scompiInventory",
					"description": "",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "variable",
							"name": "sPrevHotSign",
							"type": "string",
							"initialValue": "\"zero\"",
							"comment": "Хранит предыдущий горячий предмет",
							"isStatic": false,
							"isConstant": false,
							"sid": 785872899521990
						},
						{
							"eventType": "comment",
							"text": "КОРМЛЕНИЕ СКОМПИ: Игрок бросает предмет на Скомпи",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-drop",
									"objectClass": "itemInv",
									"sid": 903336002440288,
									"behaviorType": "DragDrop"
								},
								{
									"id": "is-overlapping-another-object",
									"objectClass": "itemInv",
									"sid": 714473590260751,
									"parameters": {
										"object": "item"
									}
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "item",
									"sid": 418566995150093,
									"parameters": {
										"instance-variable": "iSign",
										"comparison": 0,
										"value": "\"scompi\""
									}
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "itemInv",
									"sid": 280723339461627,
									"parameters": {
										"instance-variable": "class",
										"comparison": 1,
										"value": "\"inedible\""
									}
								}
							],
							"actions": [
								{
									"id": "set-key",
									"objectClass": "itemsQ",
									"sid": 184427860781491,
									"parameters": {
										"key": "itemInv.iSign",
										"value": "itemsQ.Get(itemInv.iSign)-1"
									}
								},
								{
									"callFunction": "destroyItem",
									"sid": 524598851318546,
									"parameters": [
										"itemInv.UID"
									]
								},
								{
									"id": "subtract-from-instvar",
									"objectClass": "aScompi",
									"sid": 585315807505900,
									"parameters": {
										"instance-variable": "sHunger",
										"value": "20"
									}
								},
								{
									"id": "set-animation",
									"objectClass": "item",
									"sid": 572749686068432,
									"parameters": {
										"animation": "\"eat\"",
										"from": "beginning"
									}
								}
							],
							"sid": 385159126730894
						},
						{
							"eventType": "comment",
							"text": "Генерация семечка с шансом 20% после еды",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 654067026602621,
									"parameters": {
										"first-value": "random(100)",
										"comparison": 2,
										"second-value": "20"
									}
								}
							],
							"actions": [
								{
									"callFunction": "getItem",
									"sid": 365093571558303,
									"parameters": [
										true,
										"\"thornSeed\"",
										"\"use\"",
										"0",
										"1",
										"0",
										"\"universal\""
									]
								}
							],
							"sid": 862810861968092
						},
						{
							"eventType": "comment",
							"text": "БРОСОК СКОМПИ НА КАРТУ (Вне UI)",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-drop",
									"objectClass": "itemInv",
									"sid": 714596244800237,
									"behaviorType": "DragDrop"
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "itemInv",
									"sid": 685421104033162,
									"parameters": {
										"instance-variable": "iSign",
										"comparison": 0,
										"value": "\"scompi\""
									}
								},
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 477897088407222,
									"parameters": {
										"first-value": "Mouse.Y(\"ui\")",
										"comparison": 4,
										"second-value": "150"
									}
								}
							],
							"actions": [
								{
									"callFunction": "destroyItem",
									"sid": 414057740636629,
									"parameters": [
										"itemInv.UID"
									]
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aScompi",
									"sid": 359062639399095,
									"parameters": {
										"instance-variable": "sLoc",
										"value": "\"map\""
									}
								},
								{
									"id": "start-timer",
									"objectClass": "aIns",
									"sid": 564014423564584,
									"behaviorType": "Timer",
									"parameters": {
										"duration": "5.0",
										"type": "once",
										"tag": "\"scompiReturn\""
									}
								}
							],
							"sid": 276820437554342
						},
						{
							"eventType": "comment",
							"text": "Возвращение Скомпи в инвентарь по таймеру",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-timer",
									"objectClass": "aIns",
									"sid": 412504750885877,
									"behaviorType": "Timer",
									"parameters": {
										"tag": "\"scompiReturn\""
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "aScompi",
									"sid": 686479366161742,
									"parameters": {
										"instance-variable": "sLoc",
										"value": "\"inv\""
									}
								},
								{
									"callFunction": "getItem",
									"sid": 907479672000831,
									"parameters": [
										true,
										"\"scompi\"",
										"\"pet\"",
										"0",
										"1",
										"0",
										"\"universal\""
									]
								}
							],
							"sid": 843707685782432
						},
						{
							"eventType": "comment",
							"text": "ВКЛИНИВАНИЕ: Скомпи прыгает между предметами",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"functionName": "scompiInsert",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": false,
							"functionIsAsync": false,
							"functionParameters": [
								{
									"name": "targetCount",
									"type": "number",
									"initialValue": "0",
									"comment": "iCount предмета, после которого встает Скомпи",
									"sid": 997153356172862
								}
							],
							"eventType": "function-block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "itemInv",
									"sid": 482558538451611,
									"parameters": {
										"instance-variable": "iSign",
										"comparison": 0,
										"value": "\"scompi\""
									}
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "item",
									"sid": 893149524917406,
									"parameters": {
										"instance-variable": "iSign",
										"comparison": 0,
										"value": "\"scompi\""
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "itemInv",
									"sid": 407099994397286,
									"parameters": {
										"instance-variable": "iCount",
										"value": "targetCount + 0.5"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "item",
									"sid": 553560043361805,
									"parameters": {
										"instance-variable": "iCount",
										"value": "targetCount + 0.5"
									}
								},
								{
									"callFunction": "cellN",
									"sid": 645079603964410
								},
								{
									"callFunction": "items",
									"sid": 883519950487223
								}
							],
							"sid": 785997912357697
						},
						{
							"eventType": "comment",
							"text": "ЗАХВАТ ГОРЯЧЕГО СЛОТА",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"functionName": "scompiSetHot",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": false,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "aUI",
									"sid": 651032254339162,
									"parameters": {
										"instance-variable": "hotSign",
										"comparison": 1,
										"value": "\"scompi\""
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 806921448344423,
									"parameters": {
										"variable": "sPrevHotSign",
										"value": "aUI.hotSign"
									}
								},
								{
									"customAction": "unHotItem",
									"objectClass": "aUI",
									"sid": 223426951373110
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aUI",
									"sid": 884950777576932,
									"parameters": {
										"instance-variable": "hotSign",
										"value": "\"scompi\""
									}
								},
								{
									"customAction": "hotItem",
									"objectClass": "aUI",
									"sid": 773822617201036
								}
							],
							"sid": 626289349631778
						},
						{
							"eventType": "comment",
							"text": "ОСВОБОЖДЕНИЕ ГОРЯЧЕГО СЛОТА",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"functionName": "scompiRemoveHot",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": false,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "aUI",
									"sid": 380835680417285,
									"parameters": {
										"instance-variable": "hotSign",
										"comparison": 0,
										"value": "\"scompi\""
									}
								}
							],
							"actions": [
								{
									"customAction": "unHotItem",
									"objectClass": "aUI",
									"sid": 873505469789169
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aUI",
									"sid": 386290986392012,
									"parameters": {
										"instance-variable": "hotSign",
										"value": "sPrevHotSign"
									}
								}
							],
							"sid": 933548252007619,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-eventvar",
											"objectClass": "System",
											"sid": 575066447508325,
											"parameters": {
												"variable": "sPrevHotSign",
												"comparison": 1,
												"value": "\"zero\""
											}
										}
									],
									"actions": [
										{
											"customAction": "hotItem",
											"objectClass": "aUI",
											"sid": 950135188952002
										}
									],
									"sid": 932460442194378
								}
							]
						}
					],
					"sid": 530985257935699
				}
			],
			"sid": 715233710309486
		}
	],
	"sid": 835245021672416
}