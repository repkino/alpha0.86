{
	"name": "_pfmt",
	"events": [
		{
			"eventType": "group",
			"disabled": false,
			"title": "debug",
			"description": "",
			"isActiveOnStart": false,
			"children": [
				{
					"eventType": "comment",
					"text": "если убрать, не работает"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-start-of-layout",
							"objectClass": "System",
							"sid": 572234008709161
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "aTools",
							"sid": 374370213795487,
							"parameters": {
								"instance-variable": "n",
								"comparison": 0,
								"value": "frame.n"
							}
						}
					],
					"actions": [
						{
							"id": "addobstacle11",
							"objectClass": "basis",
							"sid": 241690359847494,
							"behaviorType": "PushOutSolid",
							"parameters": {
								"obstacle0": "zoneStop"
							}
						}
					],
					"sid": 387445273310579,
					"disabled": true
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "base",
							"sid": 738774539959852,
							"disabled": true,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [
						{
							"id": "set-max-speed",
							"objectClass": "base",
							"sid": 211468074927973,
							"behaviorType": "mt",
							"parameters": {
								"max-speed": "333"
							}
						},
						{
							"id": "set-speed",
							"objectClass": "base",
							"sid": 119212110169362,
							"behaviorType": "mt",
							"parameters": {
								"speed": "322"
							}
						}
					],
					"sid": 380381769354430,
					"disabled": true
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-click",
							"objectClass": "Mouse",
							"sid": 689060658606034,
							"parameters": {
								"mouse-button": "right",
								"click-type": "clicked"
							}
						}
					],
					"actions": [],
					"sid": 117303159326433,
					"disabled": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "cursor-is-over-object",
									"objectClass": "Mouse",
									"sid": 813264962550518,
									"parameters": {
										"object": "basis"
									}
								}
							],
							"actions": [
								{
									"callFunction": "baseStop",
									"sid": 474287492503095
								}
							],
							"sid": 930566247265195,
							"disabled": true
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 863053481999881
								}
							],
							"actions": [
								{
									"callFunction": "baseStop",
									"sid": 573879087681997
								}
							],
							"sid": 626133565525208,
							"disabled": true
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "onselffunction0",
							"objectClass": "basis",
							"sid": 806534415828621,
							"behaviorType": "sf",
							"parameters": {
								"function_name:0": "\"stop\""
							}
						},
						{
							"id": "mouse-button-is-down",
							"objectClass": "Mouse",
							"sid": 406746638005850,
							"parameters": {
								"mouse-button": "left"
							}
						}
					],
					"actions": [
						{
							"id": "set-scale",
							"objectClass": "Bit",
							"sid": 143891318234173,
							"parameters": {
								"scale": "2"
							}
						}
					],
					"sid": 327492767348156,
					"disabled": true
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "onselffunction0",
							"objectClass": "basis",
							"sid": 404417307416729,
							"behaviorType": "sf",
							"parameters": {
								"function_name:0": "\"stop\""
							}
						},
						{
							"id": "mouse-button-is-down",
							"objectClass": "Mouse",
							"sid": 291888919951108,
							"parameters": {
								"mouse-button": "right"
							}
						}
					],
					"actions": [
						{
							"id": "set-scale",
							"objectClass": "Bit",
							"sid": 472094899068158,
							"parameters": {
								"scale": "0.5"
							}
						}
					],
					"sid": 545686940470203,
					"disabled": true
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "onselffunction0",
							"objectClass": "basis",
							"sid": 388194263355953,
							"behaviorType": "sf",
							"parameters": {
								"function_name:0": "\"stop\""
							}
						},
						{
							"id": "mouse-button-is-down",
							"objectClass": "Mouse",
							"sid": 898075570721167,
							"parameters": {
								"mouse-button": "middle"
							}
						}
					],
					"actions": [
						{
							"id": "set-scale",
							"objectClass": "Bit",
							"sid": 910878237233518,
							"parameters": {
								"scale": "1"
							}
						}
					],
					"sid": 649657682778436,
					"disabled": true
				}
			],
			"sid": 987670658008836
		},
		{
			"eventType": "comment",
			"text": "расчет координат в изометрии по углу и x-дистанции (круг в овал)  (сжатие Y * 0.5). Возврат: \"x;y\"  - подставляем через токенат float(tokenat(Functions.getPos(Self.X, Self.Y, 90, 100), 0(1 для Y), \";\"))"
		},
		{
			"eventType": "comment",
			"text": "Fixed getPos: Использует полярную логику (как getIsoArray), чтобы угол ввода совпадал с экранным углом."
		},
		{
			"functionName": "getPos",
			"functionDescription": "Returns \"x;y\". Params: cX, cY, angle, radius",
			"functionCategory": "",
			"functionReturnType": "string",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "cX",
					"type": "number",
					"initialValue": "0",
					"comment": "Center X",
					"sid": 401317858868960
				},
				{
					"name": "cY",
					"type": "number",
					"initialValue": "0",
					"comment": "Center Y",
					"sid": 657674528819631
				},
				{
					"name": "angle",
					"type": "number",
					"initialValue": "0",
					"comment": "Degrees",
					"sid": 837843314943861
				},
				{
					"name": "radius",
					"type": "number",
					"initialValue": "0",
					"comment": "Distance",
					"sid": 333377309799127
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "script",
					"language": "javascript",
					"script": [
						"const cx = localVars.cX;",
						"const cy = localVars.cY;",
						"const deg = localVars.angle;",
						"const r = localVars.radius;",
						"",
						"// 1. Определяем масштаб (Scale Factor) для данного угла",
						"// Логика идентична getIsoArray: берем из кеша или считаем формулу",
						"let scale = 1;",
						"",
						"// Приводим угол к индексу 0-359",
						"let idx = Math.floor(deg) % 360;",
						"if (idx < 0) idx += 360;",
						"",
						"if (globalThis.IsoCache) {",
						"    scale = globalThis.IsoCache[idx];",
						"} else {",
						"    // Резерв (если кеш не прогрузился)",
						"    const radIdx = idx * (Math.PI / 180);",
						"    const f = 0.5; ",
						"    const len = Math.hypot(f * Math.cos(radIdx), Math.sin(radIdx));",
						"    scale = (len > 0) ? (f / len) : f;",
						"}",
						"",
						"// 2. Считаем координаты, используя экранный угол (в радианах) и масштабированную длину",
						"const radScreen = deg * (Math.PI / 180);",
						"const dist = r * scale;",
						"",
						"const x = cx + (Math.cos(radScreen) * dist);",
						"const y = cy + (Math.sin(radScreen) * dist);",
						"",
						"runtime.setReturnValue(x + \";\" + y);"
					]
				}
			],
			"sid": 435075040396639
		},
		{
			"eventType": "comment",
			"text": "определение дистанции до объекта в изометрии (овал в круг)"
		},
		{
			"functionName": "getIsoDist",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "number",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "cX",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 470266333309833
				},
				{
					"name": "cY",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 576820839224688
				},
				{
					"name": "tX",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 937024062655151
				},
				{
					"name": "tY",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 355832915202403
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "script",
					"language": "javascript",
					"script": [
						"// Настройки",
						"const factor = 0.5; ",
						"",
						"// Забираем данные по НОВЫМ именам",
						"const cx = localVars.cX;",
						"const cy = localVars.cY;",
						"const tx = localVars.tX;",
						"const ty = localVars.tY;",
						"",
						"// --- ОТЛАДКА (Уберешь потом) ---",
						"// Если это первая точка, выведем в консоль координаты, чтобы проверить, не перепутались ли они",
						"if (localVars.loopindex === 0 || localVars.loopindex === 9) {",
						"    console.log(\"Check:\", { cx, cy, tx, ty });",
						"}",
						"// ------------------------------",
						"",
						"const dx = cx - tx;",
						"const dy = cy - ty;",
						"",
						"// Растягиваем Y обратно (делим, так как при рисовании умножали)",
						"const logicalDy = dy / factor; ",
						"",
						"// Пифагор",
						"const dist = Math.sqrt( (dx * dx) + (logicalDy * logicalDy) );",
						"",
						"runtime.setReturnValue(dist);"
					]
				}
			],
			"sid": 140838645141053
		},
		{
			"eventType": "comment",
			"text": "изометрический коэффициент скорости или дистанции при заданном угле из массива (массив создаётся скриптом isoAng.js)"
		},
		{
			"functionName": "getIsoArray",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "number",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "ang",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 792497980380519
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "script",
					"language": "javascript",
					"script": [
						"// Получаем входной угол",
						"const ang = localVars.ang;",
						"",
						"// 1. Взять остаток от деления (может быть отрицательным в JS!)",
						"let index = Math.floor(ang) % 360;",
						"",
						"// 2. Если получилось отрицательное число, прибавляем 360",
						"// Это превратит -90 в 270, а -1 в 359",
						"if (index < 0) index += 360;",
						"",
						"// 3. Возвращаем значение из кеша (с защитой от undefined)",
						"const cache = globalThis.IsoCache;",
						"if (cache) {",
						"    runtime.setReturnValue(cache[index]);",
						"} else {",
						"    // Резервный расчет, если кеш не создан (на всякий случай)",
						"    // Используем Math.abs, так как cos(-x) = cos(x), а sin(-x) = -sin(x), но в квадрате знак уйдет",
						"    const rad = index * (Math.PI / 180);",
						"    const factor = 0.5;",
						"    const den = Math.sqrt(Math.pow(factor * Math.cos(rad), 2) + Math.pow(Math.sin(rad), 2));",
						"    runtime.setReturnValue(factor / den);",
						"}"
					]
				}
			],
			"sid": 364956946155227
		},
		{
			"eventType": "comment",
			"text": "очередь команды на движение"
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-timer",
					"objectClass": "aIns",
					"sid": 878172553252972,
					"behaviorType": "Timer",
					"parameters": {
						"tag": "\"line\""
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "base",
					"sid": 334267298799061,
					"parameters": {
						"instance-variable": "name",
						"comparison": 0,
						"value": "\"Bit\""
					}
				}
			],
			"actions": [],
			"sid": 119301486763147,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "aIns",
							"sid": 528144362491836,
							"parameters": {
								"instance-variable": "lineRoad"
							}
						},
						{
							"id": "is-moving",
							"objectClass": "base",
							"sid": 977783620104743,
							"behaviorType": "mt",
							"isInverted": true
						}
					],
					"actions": [
						{
							"callFunction": "pfmt",
							"sid": 901567929586176,
							"parameters": [
								"base.UID",
								"\"Bit\"",
								"aIns.X",
								"aIns.Y",
								"1",
								"2",
								"2",
								"\"zero\"",
								"-1",
								"0"
							]
						}
					],
					"sid": 788440305308082,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "aIns",
									"sid": 909504000021839,
									"parameters": {
										"instance-variable": "lineJump",
										"comparison": 1,
										"value": "0"
									}
								}
							],
							"actions": [
								{
									"callFunction": "jump",
									"sid": 981167777209362,
									"parameters": [
										"\"Bit\"",
										"aIns.lineJump",
										"4000",
										"1",
										"\"map\"",
										"1",
										"1",
										false,
										false,
										"\"zero\"",
										"0"
									]
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 448336961288771,
									"parameters": {
										"instance-variable": "pushAng",
										"value": "Self.losPfmt.ReflectionAngle"
									}
								}
							],
							"sid": 286338209598747
						}
					]
				}
			]
		},
		{
			"eventType": "comment",
			"text": "    "
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "pfmt",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "trigger-once-while-true",
							"objectClass": "System",
							"sid": 969200533307686
						}
					],
					"actions": [
						{
							"type": "script",
							"language": "javascript",
							"script": [
								"init(runtime)"
							]
						},
						{
							"id": "add-obstacle",
							"objectClass": "basis",
							"sid": 222452441373392,
							"behaviorType": "losPfmt",
							"parameters": {
								"obstacle": "zoneStop"
							}
						},
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 698846065226593,
							"disabled": true,
							"behaviorType": "pf",
							"parameters": {
								"obstacle": "zoneStop"
							}
						},
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 687095854108845,
							"disabled": true,
							"behaviorType": "losPfmt",
							"parameters": {
								"obstacle": "zoneStop"
							}
						},
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 419500361112817,
							"disabled": true,
							"behaviorType": "pf",
							"parameters": {
								"obstacle": "zoneStopTh"
							}
						},
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 223767046011443,
							"disabled": true,
							"behaviorType": "losPfmt",
							"parameters": {
								"obstacle": "zoneStopTh"
							}
						}
					],
					"sid": 996353875452415,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "aTools",
									"sid": 442267687467240,
									"parameters": {
										"instance-variable": "directMT"
									}
								}
							],
							"actions": [
								{
									"id": "setenabled0",
									"objectClass": "basis",
									"sid": 160633618513925,
									"behaviorType": "PushOutSolid",
									"parameters": {
										"state2": "enabled"
									}
								},
								{
									"id": "addobstacle11",
									"objectClass": "basis",
									"sid": 107591211471754,
									"behaviorType": "PushOutSolid",
									"parameters": {
										"obstacle0": "zoneStop"
									}
								},
								{
									"id": "set-group-active",
									"objectClass": "System",
									"sid": 129953760008957,
									"parameters": {
										"group-name": "\"pathScanner\"",
										"state": "activated"
									}
								}
							],
							"sid": 423305717176326
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 360287512530147
								}
							],
							"actions": [
								{
									"id": "add-obstacle",
									"objectClass": "basis",
									"sid": 313420835363342,
									"behaviorType": "pf",
									"parameters": {
										"obstacle": "zoneStop"
									}
								},
								{
									"id": "setenabled0",
									"objectClass": "basis",
									"sid": 303946192594186,
									"behaviorType": "PushOutSolid",
									"parameters": {
										"state2": "disabled"
									}
								},
								{
									"id": "set-group-active",
									"objectClass": "System",
									"sid": 824311438401248,
									"parameters": {
										"group-name": "\"pathScanner\"",
										"state": "deactivated"
									}
								}
							],
							"sid": 694907946293781
						}
					]
				},
				{
					"eventType": "comment",
					"text": "    старт"
				},
				{
					"functionName": "pfmt",
					"functionDescription": "",
					"functionCategory": "_TOP",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "basisUID",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 692975672633782
						},
						{
							"name": "basisName",
							"type": "string",
							"initialValue": "Bit",
							"comment": "",
							"sid": 758157960825706
						},
						{
							"name": "gotoX",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 156064489140922
						},
						{
							"name": "gotoY",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 667660764662990
						},
						{
							"name": "speedCoeff",
							"type": "number",
							"initialValue": "1",
							"comment": "",
							"sid": 508844631763769
						},
						{
							"name": "impuls",
							"type": "number",
							"initialValue": "1",
							"comment": "",
							"sid": 622454284590765
						},
						{
							"name": "selfImpuls",
							"type": "number",
							"initialValue": "1",
							"comment": "",
							"sid": 108376728683578
						},
						{
							"name": "storyTag",
							"type": "string",
							"initialValue": "zero",
							"comment": "",
							"sid": 177047699102824
						},
						{
							"name": "mapUID",
							"type": "number",
							"initialValue": "-1",
							"comment": "",
							"sid": 501503898121892
						},
						{
							"name": "delta",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 634297285085973
						}
					],
					"eventType": "function-block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "aBook",
							"sid": 491208653189516,
							"parameters": {
								"instance-variable": "mod",
								"comparison": 1,
								"value": "\"pfmtBlock\""
							}
						}
					],
					"actions": [
						{
							"id": "append-text",
							"objectClass": "help",
							"sid": 508853682620662,
							"disabled": true,
							"parameters": {
								"text": "delta"
							}
						}
					],
					"sid": 204907954820044,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "aBook",
									"sid": 590220411539160,
									"parameters": {
										"instance-variable": "pfmt"
									},
									"isInverted": true
								},
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 633090116533090,
									"parameters": {
										"variable": "basisName",
										"comparison": 0,
										"value": "aBook.hero"
									}
								}
							],
							"actions": [],
							"sid": 415807891731825
						},
						{
							"eventType": "comment",
							"text": "по UID"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 292459569894377
								},
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 923031116085276,
									"parameters": {
										"first-value": "basisUID",
										"comparison": 1,
										"second-value": "0"
									}
								},
								{
									"id": "pick-by-unique-id",
									"objectClass": "basis",
									"sid": 507487810741268,
									"parameters": {
										"unique-id": "basisUID"
									}
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "basis",
									"sid": 857076604182911,
									"parameters": {
										"instance-variable": "freeToMove"
									}
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "basis",
									"sid": 625210372062584,
									"parameters": {
										"instance-variable": "teleport"
									},
									"isInverted": true
								},
								{
									"id": "pick-by-unique-id",
									"objectClass": "map",
									"sid": 637621687447291,
									"disabled": true,
									"parameters": {
										"unique-id": "mapUID"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "aIns",
									"sid": 973572750555902,
									"parameters": {
										"instance-variable": "pfmtDelta",
										"value": "delta"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aBook",
									"sid": 316383349239569,
									"parameters": {
										"instance-variable": "dialogSpotPerson",
										"value": "\"zero\""
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 662418075873269,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"groundUID\""
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 715607310200519,
									"parameters": {
										"variable": "mapUID",
										"value": "mapUID=-1?aTools.groundUID:mapUID"
									}
								},
								{
									"id": "set-text",
									"objectClass": "help",
									"sid": 665993432038239,
									"disabled": true,
									"parameters": {
										"text": "\"pfmt\""
									}
								},
								{
									"type": "comment",
									"text": ""
								},
								{
									"id": "stop",
									"objectClass": "basis",
									"sid": 947641000239186,
									"behaviorType": "mt"
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 903525601387911,
									"parameters": {
										"instance-variable": "bTag",
										"value": "storyTag"
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 253570938283341,
									"disabled": true,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "Self.bTag"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 108132589888566,
									"disabled": true,
									"parameters": {
										"instance-variable": "selfImpuls",
										"value": "speedCoeff=0?(mapUID=0?selfImpuls:map.impulsEnd):1"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 906070379878477,
									"disabled": true,
									"parameters": {
										"instance-variable": "speedImpuls",
										"value": "speedCoeff=0?(mapUID=0?impuls:map.impuls):1"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 527144131366090,
									"parameters": {
										"instance-variable": "selfImpuls",
										"value": "selfImpuls"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 872530774246856,
									"parameters": {
										"instance-variable": "speedCoeff",
										"value": "speedCoeff=0?1:speedCoeff"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 107923522458563,
									"disabled": true,
									"parameters": {
										"instance-variable": "charge",
										"value": "cursor.charge"
									}
								}
							],
							"sid": 529189592508405,
							"children": [
								{
									"eventType": "comment",
									"text": "движение без поиска пути"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "aTools",
											"sid": 929657738328871,
											"parameters": {
												"instance-variable": "directMT"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "aIns",
											"sid": 717396650562671,
											"parameters": {
												"instance-variable": "pfmtX",
												"value": "gotoX=0? Mouse.X : gotoX"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "aIns",
											"sid": 201818305652910,
											"parameters": {
												"instance-variable": "pfmtY",
												"value": "gotoY=0? Mouse.Y+aIns.hiRoad : gotoY+aIns.hiRoad"
											}
										},
										{
											"id": "callselffunction0",
											"objectClass": "basis",
											"sid": 159752785885485,
											"behaviorType": "sf",
											"parameters": {
												"function_name:0": "\"directMT\""
											}
										}
									],
									"sid": 475621235621357
								},
								{
									"eventType": "comment",
									"text": "движение с поиском пути"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 375400481888252
										}
									],
									"actions": [],
									"sid": 244229876723639,
									"children": [
										{
											"eventType": "comment",
											"text": "равнина"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-instance-variable",
													"objectClass": "aTools",
													"sid": 252446993608250,
													"parameters": {
														"instance-variable": "mapType",
														"comparison": 0,
														"value": "\"hiRoad\""
													},
													"isInverted": true
												}
											],
											"actions": [
												{
													"id": "find-path",
													"objectClass": "basis",
													"sid": 200302800133006,
													"behaviorType": "pf",
													"parameters": {
														"x": "gotoX=0? Mouse.X : gotoX",
														"y": "gotoY=0? Mouse.Y : gotoY"
													}
												}
											],
											"sid": 177618030178451,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-instance-variable",
															"objectClass": "basis",
															"sid": 681646193303657,
															"parameters": {
																"instance-variable": "name",
																"comparison": 0,
																"value": "aBook.hero"
															}
														}
													],
													"actions": [
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 158135547586009,
															"parameters": {
																"instance-variable": "pfmtX",
																"value": "gotoX=0? Mouse.X : gotoX"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 335075752384025,
															"parameters": {
																"instance-variable": "pfmtY",
																"value": "gotoY=0? Mouse.Y : gotoY"
															}
														},
														{
															"id": "find-path",
															"objectClass": "basis",
															"sid": 852985972820754,
															"disabled": true,
															"behaviorType": "pf",
															"parameters": {
																"x": "aIns.pfmtX",
																"y": "aIns.pfmtY"
															}
														}
													],
													"sid": 610589905704715
												}
											]
										},
										{
											"eventType": "comment",
											"text": "возвышенность"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-instance-variable",
													"objectClass": "aTools",
													"sid": 623334911855671,
													"parameters": {
														"instance-variable": "mapType",
														"comparison": 0,
														"value": "\"hiRoad\""
													}
												}
											],
											"actions": [
												{
													"id": "find-path",
													"objectClass": "basis",
													"sid": 992840988278140,
													"behaviorType": "pf",
													"parameters": {
														"x": "gotoX=0? Mouse.X : gotoX",
														"y": "gotoY=0? Mouse.Y+aIns.hiRoad : gotoY+aIns.hiRoad"
													}
												}
											],
											"sid": 354779826975285,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-instance-variable",
															"objectClass": "basis",
															"sid": 566405169484957,
															"parameters": {
																"instance-variable": "name",
																"comparison": 0,
																"value": "aBook.hero"
															}
														}
													],
													"actions": [
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 596534675681609,
															"parameters": {
																"instance-variable": "pfmtX",
																"value": "gotoX=0? Mouse.X : gotoX"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 803691820572024,
															"parameters": {
																"instance-variable": "pfmtY",
																"value": "gotoY=0? Mouse.Y+aIns.hiRoad : gotoY+aIns.hiRoad"
															}
														},
														{
															"id": "find-path",
															"objectClass": "basis",
															"sid": 247574359705581,
															"disabled": true,
															"behaviorType": "pf",
															"parameters": {
																"x": "aIns.pfmtX",
																"y": "aIns.pfmtY"
															}
														}
													],
													"sid": 990563114432750
												}
											]
										}
									]
								}
							]
						},
						{
							"eventType": "comment",
							"text": "по имени"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 363217651563913
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "basis",
									"sid": 947073888887986,
									"parameters": {
										"instance-variable": "name",
										"comparison": 0,
										"value": "basisName"
									}
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "basis",
									"sid": 985703168486777,
									"parameters": {
										"instance-variable": "freeToMove"
									}
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "basis",
									"sid": 982812958907081,
									"parameters": {
										"instance-variable": "teleport"
									},
									"isInverted": true
								},
								{
									"id": "pick-by-unique-id",
									"objectClass": "map",
									"sid": 557851055023881,
									"disabled": true,
									"parameters": {
										"unique-id": "mapUID"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "aIns",
									"sid": 918532105663650,
									"parameters": {
										"instance-variable": "pfmtDelta",
										"value": "delta"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aBook",
									"sid": 443085463302597,
									"parameters": {
										"instance-variable": "dialogSpotPerson",
										"value": "\"zero\""
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 212104318038608,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"groundUID\""
									}
								},
								{
									"id": "append-text",
									"objectClass": "help",
									"sid": 167193291483936,
									"disabled": true,
									"parameters": {
										"text": "\"map\""
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 358207594456643,
									"parameters": {
										"variable": "mapUID",
										"value": "mapUID=-1?aTools.groundUID:mapUID"
									}
								},
								{
									"id": "set-text",
									"objectClass": "help",
									"sid": 960940826581232,
									"disabled": true,
									"parameters": {
										"text": "\"pfmt\""
									}
								},
								{
									"type": "comment",
									"text": ""
								},
								{
									"id": "set-text",
									"objectClass": "info",
									"sid": 987062644316269,
									"disabled": true,
									"parameters": {
										"text": "mapUID"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 401743370720506,
									"parameters": {
										"instance-variable": "bTag",
										"value": "storyTag"
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 428352041921951,
									"disabled": true,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "Self.bTag"
									}
								},
								{
									"id": "stop",
									"objectClass": "basis",
									"sid": 386458795427674,
									"behaviorType": "mt"
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 906770308503370,
									"disabled": true,
									"parameters": {
										"instance-variable": "selfImpuls",
										"value": "speedCoeff=0?(mapUID=0?selfImpuls:map.impulsEnd):1"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 131651103536743,
									"disabled": true,
									"parameters": {
										"instance-variable": "speedImpuls",
										"value": "speedCoeff=0?(mapUID=0?impuls:map.impuls):1"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 433086274758267,
									"parameters": {
										"instance-variable": "selfImpuls",
										"value": "selfImpuls"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 133222933282815,
									"parameters": {
										"instance-variable": "speedCoeff",
										"value": "speedCoeff=0?1:speedCoeff"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 151410206732086,
									"disabled": true,
									"parameters": {
										"instance-variable": "charge",
										"value": "cursor.charge"
									}
								}
							],
							"sid": 292181895743968,
							"children": [
								{
									"eventType": "comment",
									"text": "движение без поиска пути"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "aTools",
											"sid": 437937485931673,
											"parameters": {
												"instance-variable": "directMT"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "aIns",
											"sid": 805106242474772,
											"parameters": {
												"instance-variable": "pfmtX",
												"value": "gotoX=0? Mouse.X : gotoX"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "aIns",
											"sid": 423254808974555,
											"parameters": {
												"instance-variable": "pfmtY",
												"value": "gotoY=0? Mouse.Y+aIns.hiRoad : gotoY+aIns.hiRoad"
											}
										},
										{
											"id": "callselffunction0",
											"objectClass": "basis",
											"sid": 444609619328812,
											"behaviorType": "sf",
											"parameters": {
												"function_name:0": "\"directMT\""
											}
										}
									],
									"sid": 359287233606356
								},
								{
									"eventType": "comment",
									"text": "движение с поиском пути"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 259275973628251
										}
									],
									"actions": [],
									"sid": 559716158358480,
									"children": [
										{
											"eventType": "comment",
											"text": "равнина"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-instance-variable",
													"objectClass": "aTools",
													"sid": 983365207287038,
													"parameters": {
														"instance-variable": "mapType",
														"comparison": 0,
														"value": "\"hiRoad\""
													},
													"isInverted": true
												}
											],
											"actions": [
												{
													"id": "find-path",
													"objectClass": "basis",
													"sid": 805799906989479,
													"behaviorType": "pf",
													"parameters": {
														"x": "gotoX=0? Mouse.X : gotoX",
														"y": "gotoY=0? Mouse.Y : gotoY"
													}
												}
											],
											"sid": 976465361887007,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-instance-variable",
															"objectClass": "basis",
															"sid": 574714104716702,
															"parameters": {
																"instance-variable": "name",
																"comparison": 0,
																"value": "aBook.hero"
															}
														}
													],
													"actions": [
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 250415049916609,
															"parameters": {
																"instance-variable": "pfmtX",
																"value": "gotoX=0? Mouse.X : gotoX"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 452909140340615,
															"parameters": {
																"instance-variable": "pfmtY",
																"value": "gotoY=0? Mouse.Y : gotoY"
															}
														},
														{
															"id": "find-path",
															"objectClass": "basis",
															"sid": 901059122337785,
															"disabled": true,
															"behaviorType": "pf",
															"parameters": {
																"x": "aIns.pfmtX",
																"y": "aIns.pfmtY"
															}
														}
													],
													"sid": 522636279902350
												}
											]
										},
										{
											"eventType": "comment",
											"text": "возвышенность"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-instance-variable",
													"objectClass": "aTools",
													"sid": 790456047777845,
													"parameters": {
														"instance-variable": "mapType",
														"comparison": 0,
														"value": "\"hiRoad\""
													}
												}
											],
											"actions": [
												{
													"id": "find-path",
													"objectClass": "basis",
													"sid": 990963243010673,
													"disabled": true,
													"behaviorType": "pf",
													"parameters": {
														"x": "gotoX=0? Mouse.X : gotoX",
														"y": "gotoY=0? Mouse.Y+aIns.mHi : gotoY+aIns.mHi"
													}
												},
												{
													"id": "find-path",
													"objectClass": "basis",
													"sid": 762383058163304,
													"behaviorType": "pf",
													"parameters": {
														"x": "gotoX=0? Mouse.X : gotoX",
														"y": "gotoY=0? Mouse.Y+aIns.hiRoad : gotoY+aIns.hiRoad"
													}
												}
											],
											"sid": 740478979142369,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-instance-variable",
															"objectClass": "basis",
															"sid": 180245672437776,
															"parameters": {
																"instance-variable": "name",
																"comparison": 0,
																"value": "aBook.hero"
															}
														}
													],
													"actions": [
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 568984153236744,
															"parameters": {
																"instance-variable": "pfmtX",
																"value": "gotoX=0? Mouse.X : gotoX"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "aIns",
															"sid": 796526064960317,
															"parameters": {
																"instance-variable": "pfmtY",
																"value": "gotoY=0? Mouse.Y+aIns.hiRoad : gotoY+aIns.hiRoad"
															}
														},
														{
															"id": "find-path",
															"objectClass": "basis",
															"sid": 580946945146949,
															"disabled": true,
															"behaviorType": "pf",
															"parameters": {
																"x": "aIns.pfmtX",
																"y": "aIns.pfmtY"
															}
														}
													],
													"sid": 942990365892151
												}
											]
										}
									]
								}
							]
						}
					]
				},
				{
					"eventType": "comment",
					"text": "\n\n\nполучение информации о поверхности по которой бежит база"
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "mapOverlap",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "comment",
							"text": ""
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "onselffunction0",
									"objectClass": "basis",
									"sid": 685863728425021,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"groundUID\""
									}
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "aGame",
									"sid": 496029072945674,
									"parameters": {
										"instance-variable": "targetMod"
									},
									"isInverted": true
								}
							],
							"actions": [
								{
									"id": "set-text",
									"objectClass": "help",
									"sid": 627163713242150,
									"disabled": true,
									"parameters": {
										"text": "\"MAP\""
									}
								}
							],
							"sid": 885490170040162,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-overlapping-another-object",
											"objectClass": "basis",
											"sid": 457861368381280,
											"parameters": {
												"object": "map"
											}
										}
									],
									"actions": [],
									"sid": 542605456993045,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "is-boolean-instance-variable-set",
													"objectClass": "map",
													"sid": 651323119480961,
													"parameters": {
														"instance-variable": "hide"
													},
													"isInverted": true
												},
												{
													"id": "compare-instance-variable",
													"objectClass": "map",
													"sid": 450866811430761,
													"parameters": {
														"instance-variable": "mName",
														"comparison": 1,
														"value": "\"zoneStop\""
													}
												}
											],
											"actions": [],
											"sid": 659492629433949,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "pick-topbottom",
															"objectClass": "map",
															"sid": 793359179921577,
															"parameters": {
																"which": "top"
															}
														}
													],
													"actions": [],
													"sid": 282187911429702,
													"children": [
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-instance-variable",
																	"objectClass": "basis",
																	"sid": 653018272506602,
																	"parameters": {
																		"instance-variable": "mapUID",
																		"comparison": 1,
																		"value": "map.UID"
																	}
																}
															],
															"actions": [
																{
																	"id": "set-instvar-value",
																	"objectClass": "basis",
																	"sid": 145478508463038,
																	"parameters": {
																		"instance-variable": "mapUID",
																		"value": "Self.mapUID"
																	}
																},
																{
																	"id": "set-instvar-value",
																	"objectClass": "basis",
																	"sid": 787332756862716,
																	"parameters": {
																		"instance-variable": "mapSpeedCoeff",
																		"value": "map.speedCoeff"
																	}
																}
															],
															"sid": 719415264554511
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-instance-variable",
																	"objectClass": "aTools",
																	"sid": 737241051953847,
																	"parameters": {
																		"instance-variable": "groundUID",
																		"comparison": 1,
																		"value": "map.UID"
																	}
																},
																{
																	"id": "compare-instance-variable",
																	"objectClass": "basis",
																	"sid": 935900155767468,
																	"parameters": {
																		"instance-variable": "name",
																		"comparison": 0,
																		"value": "aBook.hero"
																	}
																}
															],
															"actions": [
																{
																	"id": "set-instvar-value",
																	"objectClass": "aTools",
																	"sid": 360647045862025,
																	"parameters": {
																		"instance-variable": "oldGroundUID",
																		"value": "Self.groundUID"
																	}
																},
																{
																	"id": "set-instvar-value",
																	"objectClass": "aTools",
																	"sid": 859868818413083,
																	"parameters": {
																		"instance-variable": "groundUID",
																		"value": "map.UID"
																	}
																},
																{
																	"id": "monitor0",
																	"objectClass": "vm",
																	"sid": 736384889070403,
																	"parameters": {
																		"tag0": "\"groundUID\"",
																		"value1": "aTools.groundUID"
																	}
																},
																{
																	"id": "set-instvar-value",
																	"objectClass": "aTools",
																	"sid": 926492310541549,
																	"parameters": {
																		"instance-variable": "groundName",
																		"value": "map.mName"
																	}
																}
															],
															"sid": 414569389603665
														}
													]
												}
											]
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 996961443354480
										},
										{
											"id": "compare-instance-variable",
											"objectClass": "camera",
											"sid": 443737465643034,
											"parameters": {
												"instance-variable": "index",
												"comparison": 0,
												"value": "aTools.n"
											}
										},
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "camera",
											"sid": 368144886430317,
											"parameters": {
												"instance-variable": "borders"
											},
											"isInverted": true
										},
										{
											"id": "has-tags",
											"objectClass": "map",
											"sid": 395939783768362,
											"parameters": {
												"tags": "\"replace\""
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "aTools",
											"sid": 443070774941340,
											"parameters": {
												"instance-variable": "oldGroundUID",
												"value": "Self.groundUID"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "aTools",
											"sid": 795599847951249,
											"parameters": {
												"instance-variable": "groundUID",
												"value": "map.UID"
											}
										},
										{
											"id": "monitor0",
											"objectClass": "vm",
											"sid": 775146093414572,
											"parameters": {
												"tag0": "\"groundUID\"",
												"value1": "aTools.groundUID"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "aTools",
											"sid": 279624945220788,
											"parameters": {
												"instance-variable": "groundName",
												"value": "map.mName"
											}
										}
									],
									"sid": 726666350470153,
									"disabled": true
								}
							]
						}
					],
					"sid": 857922818776519
				},
				{
					"eventType": "comment",
					"text": "    путь найден, выстраивание точек и движение"
				},
				{
					"eventType": "variable",
					"name": "limitIndex",
					"type": "number",
					"initialValue": "0",
					"comment": "Сколько узлов использовать",
					"isStatic": false,
					"isConstant": false,
					"sid": 538894467888017
				},
				{
					"eventType": "variable",
					"name": "endX",
					"type": "number",
					"initialValue": "0",
					"comment": "Финальная X с учетом delta",
					"isStatic": false,
					"isConstant": false,
					"sid": 538503470857524
				},
				{
					"eventType": "variable",
					"name": "endY",
					"type": "number",
					"initialValue": "0",
					"comment": "Финальная Y с учетом delta",
					"isStatic": false,
					"isConstant": false,
					"sid": 248986414760663
				},
				{
					"eventType": "comment",
					"text": "Обратное движение (Backwards Move): Добавлена проверка calcDist < calcIsoDelta. Если герой слишком близко:\nВычисляется точка возврата (Target + Vector(Target->Hero) * Delta).\nВключается флаг aIns.deltaBackwards = true (как вы просили).\nВызывается новый pfmt к этой точке с delta = 0.\nТекущее выполнение останавливается (через переменную abort), чтобы старый путь не перебил новый.\nСтабильность Дельты (Inconsistent Delta): Разделена логика для \"Прямого пути\" (2 узла) и \"Сложного пути\" (>2 узлов).\nДля прямой: всегда жестко пересчитываем endX/endY по вектору от Цели к Герою. Это решает проблему, когда герой далеко, но путь прямой — он теперь четко встанет на границе дельты.\nДля кривой: используется расчет последнего сегмента (как было, но с уточненной логикой индексов)."
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "onselffunction0",
							"objectClass": "basis",
							"sid": 756941783753812,
							"behaviorType": "sf",
							"parameters": {
								"function_name:0": "\"directMT\""
							}
						},
						{
							"id": "on-path-found",
							"objectClass": "basis",
							"sid": 625468515642084,
							"behaviorType": "pf"
						}
					],
					"actions": [],
					"sid": 664322592100306,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "aTools",
									"sid": 120994543102898,
									"parameters": {
										"instance-variable": "directMT"
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 130963890978200,
									"parameters": {
										"variable": "endX",
										"value": "aIns.pfmtX"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 303442786898884,
									"parameters": {
										"variable": "endY",
										"value": "aIns.pfmtY"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 397444781888895,
									"parameters": {
										"variable": "limitIndex",
										"value": "0"
									}
								}
							],
							"sid": 335133068157164
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 974067916682812
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 347274731936271,
									"parameters": {
										"variable": "limitIndex",
										"value": "basis.pf.NodeCount"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 188915023221255,
									"parameters": {
										"variable": "endX",
										"value": "basis.pf.NodeXAt(basis.pf.NodeCount-1)"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 160367807989560,
									"parameters": {
										"variable": "endY",
										"value": "basis.pf.NodeYAt(basis.pf.NodeCount-1)"
									}
								}
							],
							"sid": 651244787129487
						},
						{
							"eventType": "variable",
							"name": "abort",
							"type": "number",
							"initialValue": "0",
							"comment": "1 = Прервать текущее движение (запущен перезапуск)",
							"isStatic": false,
							"isConstant": false,
							"sid": 499634824967181
						},
						{
							"eventType": "comment",
							"text": "--- ЛОГИКА ДЕЛЬТЫ (ЦИКЛ) ---"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "aIns",
									"sid": 555152047619546,
									"parameters": {
										"instance-variable": "pfmtDelta",
										"comparison": 4,
										"value": "0"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "aIns",
									"sid": 969615792611909,
									"parameters": {
										"instance-variable": "deltaUID",
										"value": "aTools.pointUID"
									}
								}
							],
							"sid": 845643549730210,
							"children": [
								{
									"eventType": "variable",
									"name": "calcDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Логическая дистанция",
									"isStatic": false,
									"isConstant": false,
									"sid": 309907811986430
								},
								{
									"eventType": "variable",
									"name": "calcAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Угол на экране",
									"isStatic": false,
									"isConstant": false,
									"sid": 725933698892983
								},
								{
									"eventType": "variable",
									"name": "calcIsoDelta",
									"type": "number",
									"initialValue": "0",
									"comment": "Экранная дельта",
									"isStatic": false,
									"isConstant": false,
									"sid": 300015118880135
								},
								{
									"eventType": "variable",
									"name": "remDelta",
									"type": "number",
									"initialValue": "0",
									"comment": "Остаток дельты для цикла",
									"isStatic": false,
									"isConstant": false,
									"sid": 203375137570587
								},
								{
									"eventType": "variable",
									"name": "segDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Длина сегмента (Логическая)",
									"isStatic": false,
									"isConstant": false,
									"sid": 945721514220392
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 329813246058313,
											"parameters": {
												"variable": "calcDist",
												"value": "Functions.getIsoDist(basis.X, basis.Y, endX, endY)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 734188344743644,
											"parameters": {
												"variable": "calcAng",
												"value": "angle(endX, endY, basis.X, basis.Y)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 177248750123419,
											"parameters": {
												"variable": "calcIsoDelta",
												"value": "aIns.pfmtDelta * Functions.getIsoArray(calcAng)"
											}
										}
									],
									"sid": 679981207612111
								},
								{
									"eventType": "comment",
									"text": "СЦЕНАРИЙ 1: Слишком близко. Отходим назад."
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 277946043127882,
											"parameters": {
												"first-value": "calcDist",
												"comparison": 2,
												"second-value": "aIns.pfmtDelta"
											}
										}
									],
									"actions": [
										{
											"callFunction": "pfmt",
											"sid": 496260625168951,
											"parameters": [
												"basis.UID",
												"basis.name",
												"endX + cos(calcAng) * calcIsoDelta",
												"endY + sin(calcAng) * calcIsoDelta",
												"1",
												"1",
												"1",
												"\"zero\"",
												"-1",
												"0"
											]
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 773303957679733,
											"parameters": {
												"variable": "abort",
												"value": "1"
											}
										},
										{
											"id": "append-text",
											"objectClass": "help",
											"sid": 282524984000844,
											"disabled": true,
											"parameters": {
												"text": "\" BACK\""
											}
										}
									],
									"sid": 901804205999975
								},
								{
									"eventType": "comment",
									"text": "СЦЕНАРИЙ 2: Путь достаточный. Обрезаем с конца."
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 176104353298970
										}
									],
									"actions": [],
									"sid": 279752577416305,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 483642680062603,
													"parameters": {
														"first-value": "basis.pf.NodeCount",
														"comparison": 3,
														"second-value": "2"
													}
												}
											],
											"actions": [
												{
													"type": "comment",
													"text": "Прямая линия: Просто ставим точку"
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 377454804213917,
													"parameters": {
														"variable": "endX",
														"value": "endX + cos(calcAng) * calcIsoDelta"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 784187369297797,
													"parameters": {
														"variable": "endY",
														"value": "endY + sin(calcAng) * calcIsoDelta"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 513114594747720,
													"parameters": {
														"variable": "limitIndex",
														"value": "0"
													}
												}
											],
											"sid": 490638392765300
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 906293870124963
												}
											],
											"actions": [
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 313448726891592,
													"parameters": {
														"variable": "remDelta",
														"value": "aIns.pfmtDelta"
													}
												}
											],
											"sid": 231847089104057,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "for",
															"objectClass": "System",
															"sid": 760710142370718,
															"parameters": {
																"name": "\"rev\"",
																"start-index": "basis.pf.NodeCount-1",
																"end-index": "1"
															}
														}
													],
													"actions": [
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 220487360653824,
															"parameters": {
																"variable": "segDist",
																"value": "Functions.getIsoDist(basis.pf.NodeXAt(loopindex(\"rev\")), basis.pf.NodeYAt(loopindex(\"rev\")), basis.pf.NodeXAt(loopindex(\"rev\")-1), basis.pf.NodeYAt(loopindex(\"rev\")-1))"
															}
														}
													],
													"sid": 719709542264623,
													"children": [
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-two-values",
																	"objectClass": "System",
																	"sid": 291117528482029,
																	"parameters": {
																		"first-value": "segDist",
																		"comparison": 5,
																		"second-value": "remDelta"
																	}
																}
															],
															"actions": [
																{
																	"type": "comment",
																	"text": "Сегмент длиннее остатка. Ставим точку тут."
																},
																{
																	"id": "set-eventvar-value",
																	"objectClass": "System",
																	"sid": 386794740734462,
																	"parameters": {
																		"variable": "endX",
																		"value": "lerp(basis.pf.NodeXAt(loopindex(\"rev\")), basis.pf.NodeXAt(loopindex(\"rev\")-1), remDelta / segDist)"
																	}
																},
																{
																	"id": "set-eventvar-value",
																	"objectClass": "System",
																	"sid": 455705235367413,
																	"parameters": {
																		"variable": "endY",
																		"value": "lerp(basis.pf.NodeYAt(loopindex(\"rev\")), basis.pf.NodeYAt(loopindex(\"rev\")-1), remDelta / segDist)"
																	}
																},
																{
																	"id": "set-eventvar-value",
																	"objectClass": "System",
																	"sid": 710025972148102,
																	"parameters": {
																		"variable": "limitIndex",
																		"value": "loopindex(\"rev\")"
																	}
																},
																{
																	"id": "stop-loop",
																	"objectClass": "System",
																	"sid": 422751781512922
																},
																{
																	"id": "append-text",
																	"objectClass": "help",
																	"sid": 884073315473176,
																	"disabled": true,
																	"parameters": {
																		"text": "\" LOOP_SET\""
																	}
																}
															],
															"sid": 114997869028896
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "else",
																	"objectClass": "System",
																	"sid": 462084347048943
																}
															],
															"actions": [
																{
																	"type": "comment",
																	"text": "Сегмент короткий. Вычитаем и идем дальше."
																},
																{
																	"id": "subtract-from-eventvar",
																	"objectClass": "System",
																	"sid": 171086380761376,
																	"parameters": {
																		"variable": "remDelta",
																		"value": "segDist"
																	}
																}
															],
															"sid": 801476843356409
														}
													]
												}
											]
										}
									]
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "aIns",
									"sid": 958155869679697,
									"parameters": {
										"instance-variable": "pfmtDelta",
										"value": "0"
									}
								}
							],
							"sid": 727328783568075
						},
						{
							"eventType": "comment",
							"text": "--- ЗАПУСК ДВИЖЕНИЯ (Если не прервано) ---"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 161910004037167,
									"parameters": {
										"variable": "abort",
										"comparison": 0,
										"value": "0"
									}
								}
							],
							"actions": [
								{
									"id": "set-boolean-instvar",
									"objectClass": "basis",
									"sid": 212505993764542,
									"parameters": {
										"instance-variable": "scanRunTeleport",
										"value": "false"
									}
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "basis",
									"sid": 744691644149319,
									"parameters": {
										"instance-variable": "startMove",
										"value": "true"
									}
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "basis",
									"sid": 516128817524104,
									"parameters": {
										"instance-variable": "move",
										"value": "true"
									}
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "basis",
									"sid": 757587978800500,
									"parameters": {
										"instance-variable": "pfmt",
										"value": "true"
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 363196262502671,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"move\""
									}
								}
							],
							"sid": 498170455053706,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "basis",
											"sid": 735960795783414,
											"parameters": {
												"instance-variable": "name",
												"comparison": 0,
												"value": "aBook.hero"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "aBook",
											"sid": 944279399143611,
											"parameters": {
												"instance-variable": "heroState",
												"value": "\"road\""
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "aGame",
											"sid": 588062273836753,
											"parameters": {
												"instance-variable": "mindState",
												"value": "\"run\""
											}
										}
									],
									"sid": 540459884620849
								},
								{
									"eventType": "comment",
									"text": ""
								},
								{
									"eventType": "variable",
									"name": "lx",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 463168421155599
								},
								{
									"eventType": "variable",
									"name": "ly",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 936604449338379
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 744468504645483,
											"parameters": {
												"variable": "lx",
												"value": "round(basis.X)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 811529730904579,
											"parameters": {
												"variable": "ly",
												"value": "round(basis.Y)"
											}
										}
									],
									"sid": 359173761237212
								},
								{
									"eventType": "comment",
									"text": "движение без поиска пути запуск функции сканирования препятствий и движения"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "aTools",
											"sid": 785816320627747,
											"parameters": {
												"instance-variable": "directMT"
											}
										}
									],
									"actions": [
										{
											"id": "move-to-position",
											"objectClass": "basis",
											"sid": 286981129366225,
											"behaviorType": "mt",
											"parameters": {
												"x": "endX",
												"y": "endY",
												"mode": "direct"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "basis",
											"sid": 930073154163165,
											"parameters": {
												"instance-variable": "goX",
												"value": "endX"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "basis",
											"sid": 524423512854992,
											"parameters": {
												"instance-variable": "goY",
												"value": "endY"
											}
										},
										{
											"callFunction": "scanPath",
											"sid": 420947920523665,
											"parameters": [
												"basis.UID",
												"basis.X",
												"basis.Y",
												"endX",
												"endY"
											]
										}
									],
									"sid": 261901569969929,
									"children": [
										{
											"eventType": "block",
											"conditions": [],
											"actions": [
												{
													"id": "set-boolean-instvar",
													"objectClass": "basis",
													"sid": 113272448608563,
													"parameters": {
														"instance-variable": "scanRunTeleport",
														"value": "true"
													}
												}
											],
											"sid": 568492900131356
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "repeat",
											"objectClass": "System",
											"sid": 729886113339945,
											"parameters": {
												"count": "limitIndex"
											}
										},
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "aTools",
											"sid": 206217998834989,
											"parameters": {
												"instance-variable": "directMT"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"id": "cast-ray",
											"objectClass": "basis",
											"sid": 746892511807052,
											"behaviorType": "losPfmt",
											"parameters": {
												"from-x": "lx",
												"from-y": "ly",
												"to-x": "basis.pf.NodeXAt(loopindex)",
												"to-y": "basis.pf.NodeYAt(loopindex)",
												"use-collision-cells": true
											}
										}
									],
									"sid": 742457571526220,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "ray-intersected",
													"objectClass": "basis",
													"sid": 517501728510691,
													"behaviorType": "losPfmt"
												},
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 631697486145891,
													"parameters": {
														"first-value": "loopindex",
														"comparison": 4,
														"second-value": "0"
													}
												}
											],
											"actions": [
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 678583725285083,
													"parameters": {
														"variable": "lx",
														"value": "basis.pf.NodeXAt(loopindex-1)"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 281942751209457,
													"parameters": {
														"variable": "ly",
														"value": "basis.pf.NodeYAt(loopindex-1)"
													}
												},
												{
													"id": "move-to-position",
													"objectClass": "basis",
													"sid": 255881131077472,
													"behaviorType": "mt",
													"parameters": {
														"x": "lx",
														"y": "ly",
														"mode": "add-waypoint"
													}
												}
											],
											"sid": 142139022729935
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "aTools",
											"sid": 233174951888870,
											"parameters": {
												"instance-variable": "directMT"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"id": "move-to-position",
											"objectClass": "basis",
											"sid": 870810999912423,
											"behaviorType": "mt",
											"parameters": {
												"x": "endX",
												"y": "endY",
												"mode": "add-waypoint"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "basis",
											"sid": 801639098320662,
											"parameters": {
												"instance-variable": "prevTargX",
												"value": "lx"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "basis",
											"sid": 406761696008644,
											"parameters": {
												"instance-variable": "prevTargY",
												"value": "ly"
											}
										}
									],
									"sid": 145900166730014,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 283723920150922,
													"parameters": {
														"variable": "lx",
														"comparison": 0,
														"value": "basis.X"
													}
												},
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 910385335088933,
													"parameters": {
														"variable": "ly",
														"comparison": 0,
														"value": "basis.Y"
													}
												}
											],
											"actions": [
												{
													"id": "set-boolean-instvar",
													"objectClass": "basis",
													"sid": 970955907383546,
													"parameters": {
														"instance-variable": "scanRunTeleport",
														"value": "true"
													}
												}
											],
											"sid": 894217068963302
										}
									]
								}
							]
						}
					],
					"isOrBlock": true
				},
				{
					"eventType": "comment",
					"text": ""
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "pathScanner",
					"description": "",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "comment",
							"text": "Движок панорамного сканирования препятствий (Raycast Sweeping)",
							"background-color": [
								0.33,
								0.73,
								0.48,
								1
							]
						},
						{
							"functionName": "scanPath",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": false,
							"functionIsAsync": false,
							"functionParameters": [
								{
									"name": "uid",
									"type": "number",
									"initialValue": "-1",
									"comment": "",
									"sid": 361807577480561
								},
								{
									"name": "startX",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 307690771057194
								},
								{
									"name": "startY",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 551628077588709
								},
								{
									"name": "targetX",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 872412539917259
								},
								{
									"name": "targetY",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 376269605673765
								}
							],
							"eventType": "function-block",
							"conditions": [
								{
									"id": "pick-by-unique-id",
									"objectClass": "basis",
									"sid": 886974374855172,
									"parameters": {
										"unique-id": "uid"
									}
								}
							],
							"actions": [],
							"sid": 967552071604200,
							"children": [
								{
									"eventType": "variable",
									"name": "targetAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Угол к цели",
									"isStatic": false,
									"isConstant": false,
									"sid": 227083383598843
								},
								{
									"eventType": "variable",
									"name": "mainUID",
									"type": "number",
									"initialValue": "0",
									"comment": "UID главного препятствия",
									"isStatic": false,
									"isConstant": false,
									"sid": 753442090138944
								},
								{
									"eventType": "variable",
									"name": "scanStep",
									"type": "number",
									"initialValue": "5",
									"comment": "Шаг сканирования в градусах",
									"isStatic": false,
									"isConstant": false,
									"sid": 493996054548977
								},
								{
									"eventType": "variable",
									"name": "lState",
									"type": "number",
									"initialValue": "0",
									"comment": "0: скан, 1: край, 2: блок",
									"isStatic": false,
									"isConstant": false,
									"sid": 248435880954042
								},
								{
									"eventType": "variable",
									"name": "rState",
									"type": "number",
									"initialValue": "0",
									"comment": "0: скан, 1: край, 2: блок",
									"isStatic": false,
									"isConstant": false,
									"sid": 552340994760223
								},
								{
									"eventType": "variable",
									"name": "lRayAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Угол последнего попадания",
									"isStatic": false,
									"isConstant": false,
									"sid": 323853053959084
								},
								{
									"eventType": "variable",
									"name": "rRayAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Угол последнего попадания",
									"isStatic": false,
									"isConstant": false,
									"sid": 943089928116281
								},
								{
									"eventType": "variable",
									"name": "lDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция до края",
									"isStatic": false,
									"isConstant": false,
									"sid": 522654400149152
								},
								{
									"eventType": "variable",
									"name": "rDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция до края",
									"isStatic": false,
									"isConstant": false,
									"sid": 758269367152994
								},
								{
									"eventType": "variable",
									"name": "lBlockDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция тупика",
									"isStatic": false,
									"isConstant": false,
									"sid": 191975204152787
								},
								{
									"eventType": "variable",
									"name": "rBlockDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция тупика",
									"isStatic": false,
									"isConstant": false,
									"sid": 154368548271211
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 633706566381625,
											"parameters": {
												"variable": "targetAng",
												"value": "angle(startX, startY, targetX, targetY)"
											}
										},
										{
											"id": "cast-ray",
											"objectClass": "basis",
											"sid": 172392043829492,
											"behaviorType": "losPfmt",
											"parameters": {
												"from-x": "startX",
												"from-y": "startY",
												"to-x": "targetX",
												"to-y": "targetY",
												"use-collision-cells": true
											}
										}
									],
									"sid": 535728028764200,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "ray-intersected",
													"objectClass": "basis",
													"sid": 740698074013091,
													"behaviorType": "losPfmt"
												}
											],
											"actions": [
												{
													"type": "comment",
													"text": "Препятствие на линии. Запоминаем его UID (HitUID) и начинаем сканирование."
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 229699359353542,
													"parameters": {
														"variable": "mainUID",
														"value": "basis.losPfmt.HitUID"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 410386284047055,
													"parameters": {
														"variable": "lRayAng",
														"value": "targetAng"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 819039996339978,
													"parameters": {
														"variable": "rRayAng",
														"value": "targetAng"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 733323399357662,
													"parameters": {
														"variable": "lDist",
														"value": "basis.losPfmt.HitDistance"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 817018901877536,
													"parameters": {
														"variable": "rDist",
														"value": "basis.losPfmt.HitDistance"
													}
												}
											],
											"sid": 866396062311266,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "for",
															"objectClass": "System",
															"sid": 326478597355068,
															"parameters": {
																"name": "\"scan\"",
																"start-index": "1",
																"end-index": "36"
															}
														}
													],
													"actions": [],
													"sid": 176893538942590,
													"children": [
														{
															"eventType": "comment",
															"text": "--- ЛЕВАЯ СТОРОНА ---",
															"background-color": [
																0.49,
																0.7,
																0.38,
																1
															]
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-eventvar",
																	"objectClass": "System",
																	"sid": 867304975463910,
																	"parameters": {
																		"variable": "lState",
																		"comparison": 0,
																		"value": "0"
																	}
																}
															],
															"actions": [
																{
																	"id": "cast-ray",
																	"objectClass": "basis",
																	"sid": 449196401069749,
																	"behaviorType": "losPfmt",
																	"parameters": {
																		"from-x": "startX",
																		"from-y": "startY",
																		"to-x": "startX + cos(targetAng - loopindex * scanStep) * 2000",
																		"to-y": "startY + sin(targetAng - loopindex * scanStep) * 2000",
																		"use-collision-cells": true
																	}
																}
															],
															"sid": 358971913183123,
															"children": [
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "ray-intersected",
																			"objectClass": "basis",
																			"sid": 782446491534097,
																			"behaviorType": "losPfmt"
																		}
																	],
																	"actions": [],
																	"sid": 572626300118588,
																	"children": [
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "compare-two-values",
																					"objectClass": "System",
																					"sid": 124785111193355,
																					"parameters": {
																						"first-value": "basis.losPfmt.HitUID",
																						"comparison": 0,
																						"second-value": "mainUID"
																					}
																				}
																			],
																			"actions": [
																				{
																					"type": "comment",
																					"text": "Всё ещё наше препятствие. Обновляем крайние точки."
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 708034215042650,
																					"parameters": {
																						"variable": "lRayAng",
																						"value": "targetAng - loopindex * scanStep"
																					}
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 214208866297880,
																					"parameters": {
																						"variable": "lDist",
																						"value": "basis.losPfmt.HitDistance"
																					}
																				}
																			],
																			"sid": 624059900848233
																		},
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "else",
																					"objectClass": "System",
																					"sid": 696016752418090
																				}
																			],
																			"actions": [],
																			"sid": 516819563494880,
																			"children": [
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "compare-two-values",
																							"objectClass": "System",
																							"sid": 983907614251971,
																							"parameters": {
																								"first-value": "basis.losPfmt.HitDistance",
																								"comparison": 2,
																								"second-value": "lDist + 20"
																							}
																						}
																					],
																					"actions": [
																						{
																							"type": "comment",
																							"text": "Наткнулись на другое препятствие БЛИЖЕ. Сторона заблокирована."
																						},
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 531402881251425,
																							"parameters": {
																								"variable": "lState",
																								"value": "2"
																							}
																						},
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 913188891942721,
																							"parameters": {
																								"variable": "lBlockDist",
																								"value": "basis.losPfmt.HitDistance"
																							}
																						}
																					],
																					"sid": 110215512733725
																				},
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "else",
																							"objectClass": "System",
																							"sid": 808086931076306
																						}
																					],
																					"actions": [
																						{
																							"type": "comment",
																							"text": "Другое препятствие ДАЛЬШЕ. Значит мы нашли край."
																						},
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 705079234035530,
																							"parameters": {
																								"variable": "lState",
																								"value": "1"
																							}
																						}
																					],
																					"sid": 216345081595185
																				}
																			]
																		}
																	]
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "else",
																			"objectClass": "System",
																			"sid": 568734743192334
																		}
																	],
																	"actions": [
																		{
																			"type": "comment",
																			"text": "Луч прошел свободно. Край найден."
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 792693584011507,
																			"parameters": {
																				"variable": "lState",
																				"value": "1"
																			}
																		}
																	],
																	"sid": 309689096072864
																}
															]
														},
														{
															"eventType": "comment",
															"text": "--- ПРАВАЯ СТОРОНА ---",
															"background-color": [
																0.49,
																0.7,
																0.38,
																1
															]
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-eventvar",
																	"objectClass": "System",
																	"sid": 321788328917987,
																	"parameters": {
																		"variable": "rState",
																		"comparison": 0,
																		"value": "0"
																	}
																}
															],
															"actions": [
																{
																	"id": "cast-ray",
																	"objectClass": "basis",
																	"sid": 420271875529425,
																	"behaviorType": "losPfmt",
																	"parameters": {
																		"from-x": "startX",
																		"from-y": "startY",
																		"to-x": "startX + cos(targetAng + loopindex * scanStep) * 2000",
																		"to-y": "startY + sin(targetAng + loopindex * scanStep) * 2000",
																		"use-collision-cells": true
																	}
																}
															],
															"sid": 749977174534077,
															"children": [
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "ray-intersected",
																			"objectClass": "basis",
																			"sid": 368165132233987,
																			"behaviorType": "losPfmt"
																		}
																	],
																	"actions": [],
																	"sid": 504510204988738,
																	"children": [
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "compare-two-values",
																					"objectClass": "System",
																					"sid": 192869200465045,
																					"parameters": {
																						"first-value": "basis.losPfmt.HitUID",
																						"comparison": 0,
																						"second-value": "mainUID"
																					}
																				}
																			],
																			"actions": [
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 747388846499022,
																					"parameters": {
																						"variable": "rRayAng",
																						"value": "targetAng + loopindex * scanStep"
																					}
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 361968479194059,
																					"parameters": {
																						"variable": "rDist",
																						"value": "basis.losPfmt.HitDistance"
																					}
																				}
																			],
																			"sid": 223627336517037
																		},
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "else",
																					"objectClass": "System",
																					"sid": 348382193230498
																				}
																			],
																			"actions": [],
																			"sid": 575998231351141,
																			"children": [
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "compare-two-values",
																							"objectClass": "System",
																							"sid": 404812674130430,
																							"parameters": {
																								"first-value": "basis.losPfmt.HitDistance",
																								"comparison": 2,
																								"second-value": "rDist + 20"
																							}
																						}
																					],
																					"actions": [
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 286398042536257,
																							"parameters": {
																								"variable": "rState",
																								"value": "2"
																							}
																						},
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 918783168939606,
																							"parameters": {
																								"variable": "rBlockDist",
																								"value": "basis.losPfmt.HitDistance"
																							}
																						}
																					],
																					"sid": 398596327880661
																				},
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "else",
																							"objectClass": "System",
																							"sid": 555378842631905
																						}
																					],
																					"actions": [
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 932465943014874,
																							"parameters": {
																								"variable": "rState",
																								"value": "1"
																							}
																						}
																					],
																					"sid": 896979632014495
																				}
																			]
																		}
																	]
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "else",
																			"objectClass": "System",
																			"sid": 991729726235923
																		}
																	],
																	"actions": [
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 777993472513064,
																			"parameters": {
																				"variable": "rState",
																				"value": "1"
																			}
																		}
																	],
																	"sid": 686403398306843
																}
															]
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-eventvar",
																	"objectClass": "System",
																	"sid": 606466319821375,
																	"parameters": {
																		"variable": "lState",
																		"comparison": 1,
																		"value": "0"
																	}
																},
																{
																	"id": "compare-eventvar",
																	"objectClass": "System",
																	"sid": 264758187194969,
																	"parameters": {
																		"variable": "rState",
																		"comparison": 1,
																		"value": "0"
																	}
																}
															],
															"actions": [
																{
																	"type": "comment",
																	"text": "Обе стороны завершили сканирование (нашли край или тупик). Прерываем цикл."
																},
																{
																	"id": "stop-loop",
																	"objectClass": "System",
																	"sid": 716070806336084
																}
															],
															"sid": 997491344012628
														}
													]
												}
											]
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 992334472928051
												}
											],
											"actions": [
												{
													"type": "comment",
													"text": "Путь чист. Идем напрямую."
												},
												{
													"id": "move-to-position",
													"objectClass": "basis",
													"sid": 490200477628712,
													"behaviorType": "mt",
													"parameters": {
														"x": "targetX",
														"y": "targetY",
														"mode": "direct"
													}
												}
											],
											"sid": 938329530868451
										}
									]
								},
								{
									"eventType": "comment",
									"text": "--- АНАЛИЗ РЕЗУЛЬТАТОВ СКАНИРОВАНИЯ ---",
									"background-color": [
										0.33,
										0.73,
										0.48,
										1
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-eventvar",
											"objectClass": "System",
											"sid": 739559200111511,
											"parameters": {
												"variable": "mainUID",
												"comparison": 1,
												"value": "0"
											}
										}
									],
									"actions": [],
									"sid": 252576251146457,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 969773416632123,
													"parameters": {
														"variable": "lState",
														"comparison": 0,
														"value": "2"
													}
												},
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 418017749093051,
													"parameters": {
														"variable": "rState",
														"comparison": 0,
														"value": "2"
													}
												}
											],
											"actions": [
												{
													"type": "comment",
													"text": "Обе стороны заблокированы. Выбираем дальнюю, добавляем 40 и идем напролом."
												},
												{
													"id": "move-to-position",
													"objectClass": "basis",
													"sid": 971289847414610,
													"behaviorType": "mt",
													"parameters": {
														"x": "startX + cos(targetAng) * (max(lBlockDist, rBlockDist) + 40)",
														"y": "startY + sin(targetAng) * (max(lBlockDist, rBlockDist) + 40)",
														"mode": "direct"
													}
												}
											],
											"sid": 657268727669610
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 247732391694906
												}
											],
											"actions": [],
											"sid": 743239212961708,
											"children": [
												{
													"eventType": "variable",
													"name": "finalAng",
													"type": "number",
													"initialValue": "0",
													"comment": "",
													"isStatic": false,
													"isConstant": false,
													"sid": 169863039801919
												},
												{
													"eventType": "variable",
													"name": "finalDist",
													"type": "number",
													"initialValue": "0",
													"comment": "",
													"isStatic": false,
													"isConstant": false,
													"sid": 538230167423816
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 406974086884107,
															"parameters": {
																"variable": "lState",
																"comparison": 0,
																"value": "1"
															}
														},
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 626481965067624,
															"parameters": {
																"variable": "rState",
																"comparison": 0,
																"value": "2"
															}
														}
													],
													"actions": [
														{
															"type": "comment",
															"text": "Право заблокировано, идем влево по 'чистому' лучу."
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 182783579435656,
															"parameters": {
																"variable": "finalAng",
																"value": "lRayAng - scanStep"
															}
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 322005786031349,
															"parameters": {
																"variable": "finalDist",
																"value": "lDist"
															}
														}
													],
													"sid": 270598822996353
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 799815094607564,
															"parameters": {
																"variable": "rState",
																"comparison": 0,
																"value": "1"
															}
														},
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 158347720675484,
															"parameters": {
																"variable": "lState",
																"comparison": 0,
																"value": "2"
															}
														}
													],
													"actions": [
														{
															"type": "comment",
															"text": "Лево заблокировано, идем вправо по 'чистому' лучу."
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 755698677224472,
															"parameters": {
																"variable": "finalAng",
																"value": "rRayAng + scanStep"
															}
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 690710254583030,
															"parameters": {
																"variable": "finalDist",
																"value": "rDist"
															}
														}
													],
													"sid": 366551677028963
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 350935952188940,
															"parameters": {
																"variable": "lState",
																"comparison": 0,
																"value": "1"
															}
														},
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 910851151697446,
															"parameters": {
																"variable": "rState",
																"comparison": 0,
																"value": "1"
															}
														}
													],
													"actions": [
														{
															"type": "comment",
															"text": "Обе стороны свободны. Выбираем ту, чей 'чистый' луч ближе к цели."
														}
													],
													"sid": 165799917685366,
													"children": [
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-two-values",
																	"objectClass": "System",
																	"sid": 999956786980858,
																	"parameters": {
																		"first-value": "abs(anglediff(targetAng, lRayAng - scanStep))",
																		"comparison": 2,
																		"second-value": "abs(anglediff(targetAng, rRayAng + scanStep))"
																	}
																}
															],
															"actions": [
																{
																	"id": "set-eventvar-value",
																	"objectClass": "System",
																	"sid": 374176985393587,
																	"parameters": {
																		"variable": "finalAng",
																		"value": "lRayAng - scanStep"
																	}
																},
																{
																	"id": "set-eventvar-value",
																	"objectClass": "System",
																	"sid": 199341434966058,
																	"parameters": {
																		"variable": "finalDist",
																		"value": "lDist"
																	}
																}
															],
															"sid": 974036046764026
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "else",
																	"objectClass": "System",
																	"sid": 240399785792191
																}
															],
															"actions": [
																{
																	"id": "set-eventvar-value",
																	"objectClass": "System",
																	"sid": 811198884731633,
																	"parameters": {
																		"variable": "finalAng",
																		"value": "rRayAng + scanStep"
																	}
																},
																{
																	"id": "set-eventvar-value",
																	"objectClass": "System",
																	"sid": 536163441428243,
																	"parameters": {
																		"variable": "finalDist",
																		"value": "rDist"
																	}
																}
															],
															"sid": 512887221524397
														}
													]
												},
												{
													"eventType": "block",
													"conditions": [],
													"actions": [
														{
															"type": "comment",
															"text": "Ставим точку на линии 'чистого' луча, прибавив 50 пикселей для обхода угла."
														},
														{
															"id": "move-to-position",
															"objectClass": "basis",
															"sid": 528370323013899,
															"behaviorType": "mt",
															"parameters": {
																"x": "startX + cos(finalAng) * (finalDist + 50)",
																"y": "startY + sin(finalAng) * (finalDist + 50)",
																"mode": "direct"
															}
														}
													],
													"sid": 468037760557488
												}
											]
										}
									]
								}
							]
						}
					],
					"sid": 658898874051818
				},
				{
					"eventType": "comment",
					"text": ""
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-arrived",
							"objectClass": "basis",
							"sid": 989359810865581,
							"behaviorType": "mt"
						}
					],
					"actions": [],
					"sid": 447151346540189,
					"children": [
						{
							"eventType": "comment",
							"text": "    финишная прямая, булева проверки расстояния для финишной телепортации"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-moving",
									"objectClass": "basis",
									"sid": 241196126632091,
									"behaviorType": "mt"
								}
							],
							"actions": [],
							"sid": 362096306106495,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 336411048095352,
											"parameters": {
												"first-value": "int(basis.X)",
												"comparison": 0,
												"second-value": "int(basis.prevTargX)"
											}
										},
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 678707506546866,
											"parameters": {
												"first-value": "int(basis.Y)",
												"comparison": 0,
												"second-value": "int(basis.prevTargY)"
											}
										}
									],
									"actions": [
										{
											"id": "set-boolean-instvar",
											"objectClass": "basis",
											"sid": 763186829593548,
											"parameters": {
												"instance-variable": "scanRunTeleport",
												"value": "true"
											}
										}
									],
									"sid": 827294832826882
								}
							]
						},
						{
							"eventType": "comment",
							"text": "    точка назначения"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 871479629609625
								}
							],
							"actions": [
								{
									"callFunction": "baseStop",
									"sid": 397551395752136
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "basis",
									"sid": 949166580088340,
									"parameters": {
										"instance-variable": "pfmt",
										"value": "false"
									}
								}
							],
							"sid": 731758986384987
						}
					]
				},
				{
					"eventType": "comment",
					"text": "обновлённая остановка для героя"
				},
				{
					"aceType": "action",
					"aceName": "heroStop",
					"objectClass": "aIns",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "stopTimers",
							"type": "boolean",
							"initialValue": "false",
							"comment": "",
							"sid": 150841713677860
						}
					],
					"eventType": "custom-ace-block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "basis",
							"sid": 549023422072755,
							"parameters": {
								"instance-variable": "name",
								"comparison": 0,
								"value": "aBook.hero"
							}
						}
					],
					"actions": [
						{
							"id": "stop",
							"objectClass": "basis",
							"sid": 416905727622593,
							"behaviorType": "mt"
						},
						{
							"customAction": "stop",
							"objectClass": "basis",
							"sid": 890594286455303
						},
						{
							"id": "callselffunction0",
							"objectClass": "basis",
							"sid": 779725207464354,
							"behaviorType": "sf",
							"parameters": {
								"function_name:0": "\"groundUID\""
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "aBook",
							"sid": 692554274179310,
							"parameters": {
								"instance-variable": "heroState",
								"value": "\"stop\""
							}
						}
					],
					"sid": 544236144026859,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "aGame",
									"sid": 121597177889587,
									"parameters": {
										"instance-variable": "autoGunPause",
										"comparison": 0,
										"value": "1"
									}
								}
							],
							"actions": [
								{
									"id": "set-boolean-instvar",
									"objectClass": "aGame",
									"sid": 691287318522408,
									"parameters": {
										"instance-variable": "autoGun",
										"value": "true"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aGame",
									"sid": 710380735166571,
									"parameters": {
										"instance-variable": "autoGunPause",
										"value": "0"
									}
								}
							],
							"sid": 406930066876846
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 144607647385409,
									"parameters": {
										"variable": "stopTimers"
									}
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "aBit",
									"sid": 473312754494849,
									"parameters": {
										"instance-variable": "blockHeroTimers"
									},
									"isInverted": true
								}
							],
							"actions": [
								{
									"id": "set-boolean-instvar",
									"objectClass": "aBit",
									"sid": 891594648203199,
									"parameters": {
										"instance-variable": "blockHeroTimers",
										"value": "true"
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 757529644872101,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"heroStopped\""
									}
								}
							],
							"sid": 252581359137011
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 473408970065010
								},
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 785200831657633,
									"parameters": {
										"variable": "stopTimers"
									},
									"isInverted": true
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "aBit",
									"sid": 775622275992598,
									"parameters": {
										"instance-variable": "blockHeroTimers"
									}
								},
								{
									"id": "is-visible",
									"objectClass": "Bit",
									"sid": 154241805037721
								}
							],
							"actions": [
								{
									"id": "set-boolean-instvar",
									"objectClass": "aBit",
									"sid": 741659630666294,
									"parameters": {
										"instance-variable": "blockHeroTimers",
										"value": "false"
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 448863952966916,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"heroStopped\""
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aGame",
									"sid": 852965751541250,
									"parameters": {
										"instance-variable": "mindState",
										"value": "\"idle\""
									}
								}
							],
							"sid": 558906646322292
						}
					]
				},
				{
					"eventType": "comment",
					"text": "    "
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "onselffunction0",
							"objectClass": "basis",
							"sid": 668977844594953,
							"behaviorType": "sf",
							"parameters": {
								"function_name:0": "\"stop\""
							}
						}
					],
					"actions": [
						{
							"callFunction": "baseStop",
							"sid": 728865276776183
						}
					],
					"sid": 896110670975963
				},
				{
					"eventType": "comment",
					"text": "    остановка для любых баз"
				},
				{
					"functionName": "baseStop",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": true,
					"functionIsAsync": false,
					"functionParameters": [],
					"eventType": "function-block",
					"conditions": [],
					"actions": [
						{
							"id": "stop",
							"objectClass": "basis",
							"sid": 944438872856811,
							"behaviorType": "mt"
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 695945754041261,
							"disabled": true,
							"parameters": {
								"instance-variable": "speedCoeff",
								"value": "1"
							}
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 825928993769946,
							"disabled": true,
							"parameters": {
								"seconds": "0",
								"use-timescale": true
							}
						},
						{
							"customAction": "stop",
							"objectClass": "basis",
							"sid": 738842183030062
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 744730746622555,
							"disabled": true,
							"parameters": {
								"seconds": "0",
								"use-timescale": true
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "person",
							"sid": 767750293269287,
							"disabled": true,
							"parameters": {
								"instance-variable": "state",
								"value": "\"stop\""
							}
						},
						{
							"id": "set-boolean-instvar",
							"objectClass": "basis",
							"sid": 427296323571363,
							"disabled": true,
							"parameters": {
								"instance-variable": "move",
								"value": "false"
							}
						}
					],
					"sid": 522900640346110,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "basis",
									"sid": 470766024481154,
									"parameters": {
										"instance-variable": "name",
										"comparison": 0,
										"value": "aBook.hero"
									}
								}
							],
							"actions": [
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 362669523320654,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"groundUID\""
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aBook",
									"sid": 952155880257769,
									"parameters": {
										"instance-variable": "heroState",
										"value": "\"stop\""
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "aGame",
									"sid": 285060332485382,
									"parameters": {
										"instance-variable": "mindState",
										"value": "\"idle\""
									}
								},
								{
									"id": "callselffunction0",
									"objectClass": "basis",
									"sid": 306991544729958,
									"behaviorType": "sf",
									"parameters": {
										"function_name:0": "\"heroStopped\""
									}
								},
								{
									"id": "signal",
									"objectClass": "System",
									"sid": 863960317894114,
									"parameters": {
										"tag": "\"heroStopped\""
									}
								}
							],
							"sid": 624738511292842,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "aIns",
											"sid": 740508310211956,
											"parameters": {
												"instance-variable": "deltaUID",
												"comparison": 4,
												"value": "0"
											}
										},
										{
											"id": "pick-by-unique-id",
											"objectClass": "point",
											"sid": 657983630192461,
											"parameters": {
												"unique-id": "aIns.deltaUID"
											}
										}
									],
									"actions": [
										{
											"customAction": "rotateTo",
											"objectClass": "aaa",
											"sid": 788527227924116,
											"parameters": [
												"aBook.hero",
												"-1",
												"-1",
												false,
												"aIns.deltaUID",
												false,
												"0"
											]
										},
										{
											"id": "wait",
											"objectClass": "System",
											"sid": 107812964781034,
											"disabled": true,
											"parameters": {
												"seconds": "0",
												"use-timescale": false
											}
										},
										{
											"id": "instance-signal",
											"objectClass": "basis",
											"sid": 878779143463307,
											"parameters": {
												"tag": "\"deltaStop\""
											}
										},
										{
											"id": "wait",
											"objectClass": "System",
											"sid": 755489734106542,
											"parameters": {
												"seconds": "0",
												"use-timescale": false
											}
										},
										{
											"id": "wait",
											"objectClass": "System",
											"sid": 981231284183193,
											"parameters": {
												"seconds": "0",
												"use-timescale": false
											}
										},
										{
											"id": "wait",
											"objectClass": "System",
											"sid": 966995195889051,
											"disabled": true,
											"parameters": {
												"seconds": "0.1",
												"use-timescale": false
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "aIns",
											"sid": 787054068665513,
											"parameters": {
												"instance-variable": "deltaUID",
												"value": "0"
											}
										}
									],
									"sid": 376376301910708
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "aGame",
											"sid": 267525584294282,
											"parameters": {
												"instance-variable": "autoGunPause",
												"comparison": 0,
												"value": "1"
											}
										}
									],
									"actions": [
										{
											"id": "set-boolean-instvar",
											"objectClass": "aGame",
											"sid": 305324996538159,
											"parameters": {
												"instance-variable": "autoGun",
												"value": "true"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "aGame",
											"sid": 611067897953918,
											"parameters": {
												"instance-variable": "autoGunPause",
												"value": "0"
											}
										}
									],
									"sid": 271778292308364
								}
							]
						}
					]
				},
				{
					"eventType": "comment",
					"text": "    выталкивание из препятствия"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "aTools",
							"sid": 743287188929318,
							"parameters": {
								"instance-variable": "directMT"
							}
						},
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 406985035410223,
							"parameters": {
								"instance-variable": "move"
							}
						},
						{
							"id": "is-overlapping-another-object",
							"objectClass": "basis",
							"sid": 225642254875128,
							"parameters": {
								"object": "zoneStop"
							}
						}
					],
					"actions": [
						{
							"id": "cast-ray",
							"objectClass": "basis",
							"sid": 388128629052155,
							"behaviorType": "losPfmt",
							"parameters": {
								"from-x": "basis.X",
								"from-y": "basis.Y",
								"to-x": "float(tokenat(Functions.getPos(Self.X, Self.Y, Self.Angle, 30), 0, \";\"))",
								"to-y": "float(tokenat(Functions.getPos(Self.X, Self.Y, Self.Angle, 30), 1, \";\"))",
								"use-collision-cells": true
							}
						}
					],
					"sid": 102968314806150,
					"disabled": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "ray-intersected",
									"objectClass": "basis",
									"sid": 462100282365144,
									"behaviorType": "losPfmt"
								}
							],
							"actions": [
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 971313565352871,
									"parameters": {
										"x": "Self.X + cos(abs(anglediff(Self.Angle, Self.losPfmt.ReflectionAngle)) > 160 ? Self.losPfmt.ReflectionAngle + 60 : Self.losPfmt.ReflectionAngle) * (Self.speedTotal * 1.5 * dt)",
										"y": "Self.Y + sin(abs(anglediff(Self.Angle, Self.losPfmt.ReflectionAngle)) > 160 ? Self.losPfmt.ReflectionAngle + 60 : Self.losPfmt.ReflectionAngle) * (Self.speedTotal * 1.5 * dt)"
									}
								}
							],
							"sid": 533030557972789
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "ray-intersected",
									"objectClass": "basis",
									"sid": 841732036013064,
									"behaviorType": "losPfmt"
								}
							],
							"actions": [
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 771928882531269,
									"disabled": true,
									"parameters": {
										"x": "Self.X + cos(Self.losPfmt.ReflectionAngle + (angle(Self.X, Self.Y, Self.X + cos(Self.mt.MovingAngle), Self.Y + sin(Self.mt.MovingAngle)) > angle(Self.X, Self.Y, Self.X + cos(Self.losPfmt.ReflectionAngle), Self.Y + sin(Self.losPfmt.ReflectionAngle)) ? 90 : -90)) * (Self.speedTotal * 1.5 * dt)",
										"y": "Self.Y + sin(Self.losPfmt.ReflectionAngle + (angle(Self.X, Self.Y, Self.X + cos(Self.mt.MovingAngle), Self.Y + sin(Self.mt.MovingAngle)) > angle(Self.X, Self.Y, Self.X + cos(Self.losPfmt.ReflectionAngle), Self.Y + sin(Self.losPfmt.ReflectionAngle)) ? 90 : -90)) * (Self.speedTotal * 1.5 * dt)"
									}
								},
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 724353172370282,
									"parameters": {
										"x": "Self.X + cos(Self.losPfmt.ReflectionAngle + (sin(Self.mt.MovingAngle - Self.losPfmt.ReflectionAngle) > 0 ? 90 : -90)) * (Self.speedTotal * 1.5 * dt)",
										"y": "Self.Y + sin(Self.losPfmt.ReflectionAngle + (sin(Self.mt.MovingAngle - Self.losPfmt.ReflectionAngle) > 0 ? 90 : -90)) * (Self.speedTotal * 1.5 * dt)"
									}
								}
							],
							"sid": 300857145106065,
							"disabled": true
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 241683641127973
								}
							],
							"actions": [
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 573037365906016,
									"parameters": {
										"x": "Self.X + cos(angle(zoneStop.X, zoneStop.Y, Self.X, Self.Y)) * (Self.speedTotal * 3 * dt)",
										"y": "Self.Y + sin(angle(zoneStop.X, zoneStop.Y, Self.X, Self.Y)) * (Self.speedTotal * 3 * dt)"
									}
								}
							],
							"sid": 225237251386991,
							"disabled": true
						}
					]
				},
				{
					"eventType": "comment",
					"text": "ШАГ 1: Только выталкивание. Возвращаем героя на границу стены, если он зашел внутрь.",
					"background-color": [
						0.33,
						0.73,
						0.48,
						1
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "aTools",
							"sid": 639662927478865,
							"parameters": {
								"instance-variable": "directMT"
							}
						},
						{
							"id": "is-overlapping-another-object",
							"objectClass": "basis",
							"sid": 291371091516814,
							"parameters": {
								"object": "zoneStop"
							}
						}
					],
					"actions": [
						{
							"id": "cast-ray",
							"objectClass": "basis",
							"sid": 394858027561223,
							"behaviorType": "losPfmt",
							"parameters": {
								"from-x": "Self.X - cos(Self.mt.MovingAngle) * 50",
								"from-y": "Self.Y - sin(Self.mt.MovingAngle) * 50",
								"to-x": "Self.X",
								"to-y": "Self.Y",
								"use-collision-cells": true
							}
						}
					],
					"sid": 855773389607482,
					"disabled": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "ray-intersected",
									"objectClass": "basis",
									"sid": 359100288966448,
									"behaviorType": "losPfmt"
								}
							],
							"actions": [
								{
									"type": "comment",
									"text": "Мгновенно возвращаем в точку контакта + 2 пикселя наружу"
								},
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 715462745960118,
									"parameters": {
										"x": "Self.losPfmt.HitX + cos(Self.losPfmt.ReflectionAngle) * 2",
										"y": "Self.losPfmt.HitY + sin(Self.losPfmt.ReflectionAngle) * 2"
									}
								}
							],
							"sid": 434765203159239,
							"disabled": true
						}
					]
				},
				{
					"eventType": "comment",
					"text": "ШАГ 2: Исправлено обращение к переменной pushAng. Добавлено скольжение вдоль стены.",
					"background-color": [
						0.33,
						0.73,
						0.48,
						1
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "aTools",
							"sid": 471280466287898,
							"parameters": {
								"instance-variable": "directMT"
							}
						},
						{
							"id": "is-overlapping-another-object",
							"objectClass": "basis",
							"sid": 484901228340533,
							"parameters": {
								"object": "zoneStop"
							}
						}
					],
					"actions": [
						{
							"id": "cast-ray",
							"objectClass": "basis",
							"sid": 175060392432273,
							"behaviorType": "losPfmt",
							"parameters": {
								"from-x": "Self.X - cos(Self.mt.MovingAngle) * 50",
								"from-y": "Self.Y - sin(Self.mt.MovingAngle) * 50",
								"to-x": "Self.X",
								"to-y": "Self.Y",
								"use-collision-cells": true
							}
						}
					],
					"sid": 991738732544076,
					"disabled": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "ray-intersected",
									"objectClass": "basis",
									"sid": 363495872134911,
									"behaviorType": "losPfmt"
								}
							],
							"actions": [
								{
									"type": "comment",
									"text": "1. Выталкиваем на границу. 2. Выбираем лучший угол скольжения (pushAng)."
								},
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 422428454119774,
									"parameters": {
										"x": "Self.losPfmt.HitX + cos(Self.losPfmt.ReflectionAngle) * 2",
										"y": "Self.losPfmt.HitY + sin(Self.losPfmt.ReflectionAngle) * 2"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 211355203617932,
									"parameters": {
										"instance-variable": "pushAng",
										"value": "abs(anglediff(Self.mt.MovingAngle, Self.losPfmt.ReflectionAngle + 90)) < abs(anglediff(Self.mt.MovingAngle, Self.losPfmt.ReflectionAngle - 90)) ? Self.losPfmt.ReflectionAngle + 90 : Self.losPfmt.ReflectionAngle - 90"
									}
								},
								{
									"type": "comment",
									"text": "Двигаемся вдоль стены с небольшим вектором 'от неё' (anglelerp)"
								},
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 743179636078571,
									"parameters": {
										"x": "Self.X + cos(anglelerp(Self.pushAng, Self.losPfmt.ReflectionAngle, 0.15)) * (Self.speedTotal * dt)",
										"y": "Self.Y + sin(anglelerp(Self.pushAng, Self.losPfmt.ReflectionAngle, 0.15)) * (Self.speedTotal * dt)"
									}
								}
							],
							"sid": 612728011496195,
							"disabled": true
						}
					]
				},
				{
					"eventType": "comment",
					"text": "\n    выталкивание изнутри препятствия "
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-failed-to-find-path",
							"objectClass": "basis",
							"sid": 702214291744765,
							"behaviorType": "pf"
						},
						{
							"id": "is-overlapping-another-object",
							"objectClass": "basis",
							"sid": 608082498127785,
							"parameters": {
								"object": "zoneStop"
							}
						}
					],
					"actions": [
						{
							"id": "move-to-position",
							"objectClass": "basis",
							"sid": 464322150541961,
							"behaviorType": "mt",
							"parameters": {
								"x": "Self.X+10*cos(angle(zoneStop.X,zoneStop.Y,basis.X,basis.Y))",
								"y": "Self.Y+10*sin(angle(zoneStop.X,zoneStop.Y,basis.X,basis.Y))",
								"mode": "direct"
							}
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 900566212411599,
							"disabled": true,
							"parameters": {
								"seconds": "0",
								"use-timescale": true
							}
						},
						{
							"callFunction": "pfmt",
							"sid": 357413475490379,
							"disabled": true,
							"parameters": [
								"basis.UID",
								"basis.name",
								"basis.X+15*cos(angle(zoneStop.X,zoneStop.Y,basis.X,basis.Y))",
								"basis.Y+15*sin(angle(zoneStop.X,zoneStop.Y,basis.X,basis.Y))",
								"1",
								"1",
								"1",
								"\"zero\"",
								"-1",
								"0"
							]
						}
					],
					"sid": 941662304606992
				}
			],
			"sid": 690930157047945
		},
		{
			"eventType": "comment",
			"text": "    "
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "pfbzEngine",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"aceType": "action",
					"aceName": "addWaypoint",
					"objectClass": "basis",
					"functionDescription": "",
					"functionCategory": "pfbz",
					"functionReturnType": "none",
					"functionCopyPicked": true,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "x",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 119954836066940
						},
						{
							"name": "y",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 366805422960468
						}
					],
					"eventType": "custom-ace-block",
					"conditions": [],
					"actions": [
						{
							"type": "script",
							"language": "javascript",
							"script": [
								"paths[runtime.objects.basis.getFirstPickedInstance().uid].addWaypoint(localVars.x,localVars.y);"
							]
						}
					],
					"sid": 496176668422883
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 348263650437659,
							"parameters": {
								"instance-variable": "move"
							}
						},
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 819609416024069,
							"parameters": {
								"instance-variable": "mtbz"
							}
						}
					],
					"actions": [],
					"sid": 776094286756464,
					"children": [
						{
							"eventType": "variable",
							"name": "x",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 324104567743890
						},
						{
							"eventType": "variable",
							"name": "y",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 198301731192406
						},
						{
							"eventType": "variable",
							"name": "temp",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 841305115088570
						},
						{
							"eventType": "variable",
							"name": "speed",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 490451059151744
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "for-each",
									"objectClass": "System",
									"sid": 998004296939276,
									"parameters": {
										"object": "basis"
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 159062699829718,
									"parameters": {
										"variable": "temp",
										"value": "basis.UID"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 297108581542793,
									"parameters": {
										"variable": "speed",
										"value": "basis.speedTotal"
									}
								},
								{
									"type": "script",
									"language": "javascript",
									"script": [
										"const temp = paths[localVars.temp].move(localVars.speed);",
										"localVars.x = temp.x;",
										"localVars.y = temp.y;"
									]
								},
								{
									"id": "set-position",
									"objectClass": "basis",
									"sid": 294089051981658,
									"parameters": {
										"x": "x",
										"y": "y"
									}
								},
								{
									"type": "script",
									"language": "javascript",
									"script": [
										"const obj = runtime.objects.basis.getFirstPickedInstance();",
										"obj.angle = paths[obj.uid].angle;"
									]
								},
								{
									"id": "set-moving-angle",
									"objectClass": "basis",
									"sid": 708975710279759,
									"behaviorType": "mt",
									"parameters": {
										"angle": "Self.Angle"
									}
								}
							],
							"sid": 273269868317478
						}
					]
				},
				{
					"functionName": "pfbzStop",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "uid",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 831953887314081
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 183835647645065,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-by-unique-id",
									"objectClass": "basis",
									"sid": 631996146413957,
									"parameters": {
										"unique-id": "uid"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 199262554473789,
									"disabled": true,
									"parameters": {
										"instance-variable": "speedCoeff",
										"value": "1"
									}
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "basis",
									"sid": 778400819860497,
									"disabled": true,
									"parameters": {
										"instance-variable": "move",
										"value": "false"
									}
								},
								{
									"customAction": "stop",
									"objectClass": "basis",
									"sid": 192942003748513,
									"disabled": true
								},
								{
									"callFunction": "baseStop",
									"sid": 798383515459408
								}
							],
							"sid": 997397074776504
						}
					]
				}
			],
			"sid": 578038966362332
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "speedPerspective",
			"description": "",
			"isActiveOnStart": false,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 113196246869636,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 264357799650574,
							"parameters": {
								"instance-variable": "ang",
								"value": "round(Self.Angle-360*floor(Self.Angle/360))"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 822120972306793,
							"parameters": {
								"instance-variable": "angZ",
								"value": "(Self.ang>90)&(Self.ang<=270)?atan(tan(Self.ang)/aTools.isoCoeff)+180:atan(tan(Self.ang)/aTools.isoCoeff)"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 232656475101734,
							"parameters": {
								"instance-variable": "zSpeed",
								"value": "Self.ang=90 | Self.ang=270 ? round(Self.speedMax*aTools.isoCoeff) : round(Self.speedMax*cos(Self.angZ)/cos(Self.ang))"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 239472629024267,
							"parameters": {
								"instance-variable": "speedGround",
								"value": "round(abs(Self.zSpeed)*Self.speedCoeff)"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 598197054886511,
							"disabled": true,
							"parameters": {
								"instance-variable": "speedGround",
								"value": "round(abs(Self.zSpeed)*Self.speedCoeff*Self.speedImpuls)"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 133429681347513,
							"disabled": true,
							"parameters": {
								"instance-variable": "speedImpuls",
								"value": "lerp(Self.speedImpuls,Self.selfImpuls,1.8*dt)"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 747133918786885,
							"disabled": true,
							"parameters": {
								"instance-variable": "speedTotal",
								"value": "Self.speedGround*Self.zScale*aBook.heroScaleCoeff"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 947992545020533,
							"disabled": true,
							"parameters": {
								"instance-variable": "speedTotal",
								"value": "Self.speedGround*Self.zScale*aBook.heroScaleCoeff+Self.charge"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 200416923392428,
							"disabled": true,
							"parameters": {
								"instance-variable": "charge",
								"value": "clamp(round(Self.charge-60*dt),0,100)"
							}
						},
						{
							"id": "fill-ellipse",
							"objectClass": "DrawingCanvas",
							"sid": 968534796483002,
							"disabled": true,
							"parameters": {
								"x": "basis.X",
								"y": "basis.Y",
								"radius-x": "0.5",
								"radius-y": "0.5",
								"color": "rgba(0, 0, 0, 100)",
								"edge": "smooth"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 650115502098739,
							"disabled": true,
							"parameters": {
								"instance-variable": "speedImpuls",
								"value": "lerp(Self.speedImpuls,1,1.8*dt)"
							}
						}
					],
					"sid": 296555254374338
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 365135829622939,
							"parameters": {
								"instance-variable": "controlMove"
							}
						},
						{
							"id": "pick-by-unique-id",
							"objectClass": "map",
							"sid": 613733285016395,
							"parameters": {
								"unique-id": "aTools.groundUID"
							}
						}
					],
					"actions": [],
					"sid": 110667145836369,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "basis",
									"sid": 231430008998077,
									"parameters": {
										"instance-variable": "name",
										"comparison": 0,
										"value": "aBook.hero"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 457054276368898,
									"parameters": {
										"instance-variable": "speedTotal",
										"value": "Self.speedGround*Self.zScale*aBook.heroScaleCoeff*Self.mapSpeedCoeff*aIns.hSpeedReduse"
									}
								}
							],
							"sid": 397802966727870
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 705919647218775
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 603369220088375,
									"parameters": {
										"instance-variable": "speedTotal",
										"value": "Self.speedGround*Self.zScale*aBook.heroScaleCoeff*Self.mapSpeedCoeff"
									}
								}
							],
							"sid": 505635529438644
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 962001355154963,
							"parameters": {
								"instance-variable": "controlMove"
							},
							"isInverted": true
						}
					],
					"actions": [
						{
							"id": "set-instvar-value",
							"objectClass": "basis",
							"sid": 694331562867946,
							"parameters": {
								"instance-variable": "speedTotal",
								"value": "Self.speedGround*Self.zScale*aBook.heroScaleCoeff"
							}
						}
					],
					"sid": 999787515115518
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "base",
							"sid": 372735994286854,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [
						{
							"id": "set-max-speed",
							"objectClass": "base",
							"sid": 809655594555618,
							"behaviorType": "mt",
							"parameters": {
								"max-speed": "Self.speedTotal+10"
							}
						},
						{
							"id": "set-speed",
							"objectClass": "base",
							"sid": 303581825252689,
							"behaviorType": "mt",
							"parameters": {
								"speed": "Self.speedTotal"
							}
						}
					],
					"sid": 306351038690502
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "serpent",
							"sid": 730619558261125,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [
						{
							"id": "set-max-speed",
							"objectClass": "serpent",
							"sid": 432326196576239,
							"behaviorType": "mt",
							"parameters": {
								"max-speed": "Self.speedTotal+10"
							}
						},
						{
							"id": "set-speed",
							"objectClass": "serpent",
							"sid": 263117207357035,
							"behaviorType": "mt",
							"parameters": {
								"speed": "Self.speedTotal"
							}
						}
					],
					"sid": 157507221969850
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 817239453401576,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [
						{
							"id": "set-max-speed",
							"objectClass": "basis",
							"sid": 521049439347282,
							"behaviorType": "mt",
							"parameters": {
								"max-speed": "Self.speedTotal+10"
							}
						},
						{
							"id": "set-speed",
							"objectClass": "basis",
							"sid": 665045491509473,
							"behaviorType": "mt",
							"parameters": {
								"speed": "Self.speedTotal"
							}
						}
					],
					"sid": 464490115757737,
					"disabled": true
				}
			],
			"sid": 452946205894770
		},
		{
			"eventType": "comment",
			"text": "    "
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "speedIsometric",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 743391229630633,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [],
					"sid": 789328861518146,
					"children": [
						{
							"eventType": "comment",
							"text": ""
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "basis",
									"sid": 350675593374970,
									"parameters": {
										"instance-variable": "name",
										"comparison": 0,
										"value": "aBook.hero"
									},
									"isInverted": true
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "basis",
									"sid": 770510485545072,
									"parameters": {
										"instance-variable": "type",
										"comparison": 1,
										"value": "\"serpent\""
									}
								},
								{
									"id": "pick-by-unique-id",
									"objectClass": "map",
									"sid": 920280243616759,
									"parameters": {
										"unique-id": "aTools.groundUID"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 756258363940459,
									"parameters": {
										"instance-variable": "zSpeed",
										"value": "Functions.getIsoArray(Self.Angle)*Self.speedMax"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 495358695543004,
									"parameters": {
										"instance-variable": "speedGround",
										"value": "round(abs(Self.zSpeed)*Self.speedCoeff)"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 846398932108808,
									"parameters": {
										"instance-variable": "speedTotal",
										"value": "Self.speedGround*aBook.heroScaleCoeff*Self.mapSpeedCoeff*aIns.hSpeedReduse*Self.selfImpuls"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 622945142530737,
									"parameters": {
										"instance-variable": "selfImpuls",
										"value": "clamp(Self.selfImpuls-0.02,1,10)"
									}
								}
							],
							"sid": 643267529186177
						},
						{
							"eventType": "comment",
							"text": ""
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "basis",
									"sid": 112588994640699,
									"parameters": {
										"instance-variable": "name",
										"comparison": 0,
										"value": "aBook.hero"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 391871047067294,
									"parameters": {
										"instance-variable": "zSpeed",
										"value": "Functions.getIsoArray(Self.Angle)*Self.speedMax"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 125105363266664,
									"disabled": true,
									"parameters": {
										"instance-variable": "zSpeed",
										"value": "Functions.getIsoArray(Self.mt.MovingAngle)*Self.speedMax"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 820855167306911,
									"parameters": {
										"instance-variable": "speedGround",
										"value": "round(abs(Self.zSpeed)*Self.speedCoeff)"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "basis",
									"sid": 254636272396417,
									"parameters": {
										"instance-variable": "SIC",
										"value": "Self.zSpeed/Self.speedMax"
									}
								}
							],
							"sid": 740994088108778,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "basis",
											"sid": 448717440047934,
											"parameters": {
												"instance-variable": "controlMove"
											}
										},
										{
											"id": "pick-by-unique-id",
											"objectClass": "map",
											"sid": 892310315138159,
											"parameters": {
												"unique-id": "aTools.groundUID"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "basis",
											"sid": 934526792882699,
											"parameters": {
												"instance-variable": "speedTotal",
												"value": "Self.speedGround*aBook.heroScaleCoeff*Self.mapSpeedCoeff*aIns.hSpeedReduse*Self.selfImpuls"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "basis",
											"sid": 137306481975090,
											"parameters": {
												"instance-variable": "selfImpuls",
												"value": "clamp(Self.selfImpuls - (1.2 * dt * Self.SIC), 1, 10)"
											}
										}
									],
									"sid": 485314530742507
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "basis",
											"sid": 999244297289584,
											"parameters": {
												"instance-variable": "controlMove"
											},
											"isInverted": true
										}
									],
									"actions": [],
									"sid": 165318446385354,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "is-boolean-instance-variable-set",
													"objectClass": "basis",
													"sid": 376937168660865,
													"parameters": {
														"instance-variable": "getKick"
													}
												}
											],
											"actions": [
												{
													"id": "set-instvar-value",
													"objectClass": "basis",
													"sid": 979586780108985,
													"parameters": {
														"instance-variable": "speedTotal",
														"value": "Self.speedGround*aBook.heroScaleCoeff*Self.selfImpuls"
													}
												},
												{
													"id": "set-instvar-value",
													"objectClass": "basis",
													"sid": 283646052028646,
													"parameters": {
														"instance-variable": "selfImpuls",
														"value": "clamp(Self.selfImpuls - (1.2 * dt * Self.SIC), 1, 10)"
													}
												},
												{
													"id": "set-instvar-value",
													"objectClass": "basis",
													"sid": 755349812774354,
													"disabled": true,
													"parameters": {
														"instance-variable": "selfImpuls",
														"value": "clamp(Self.selfImpuls-0.02*Self.SIC,1,10)"
													}
												}
											],
											"sid": 638892211428423
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 320169087037833
												}
											],
											"actions": [
												{
													"id": "set-instvar-value",
													"objectClass": "basis",
													"sid": 248893272755362,
													"parameters": {
														"instance-variable": "speedTotal",
														"value": "Self.speedGround*Self.zScale*aBook.heroScaleCoeff"
													}
												}
											],
											"sid": 312413804995599
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "basis",
											"sid": 108903657156923,
											"parameters": {
												"instance-variable": "groundUID",
												"comparison": 1,
												"value": "map.UID"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "basis",
											"sid": 960251988064723,
											"parameters": {
												"instance-variable": "speedCoeffTotal",
												"value": "Self.speedCoeff*Self.speedImpuls*map.speedCoeff"
											}
										}
									],
									"sid": 521909007646877,
									"disabled": true
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "every-x-seconds",
											"objectClass": "System",
											"sid": 732051034276120,
											"parameters": {
												"interval-seconds": "0.1"
											}
										}
									],
									"actions": [
										{
											"id": "callselffunction0",
											"objectClass": "basis",
											"sid": 162606792410558,
											"behaviorType": "sf",
											"parameters": {
												"function_name:0": "\"groundUID\""
											}
										}
									],
									"sid": 495739570822476
								}
							]
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "base",
							"sid": 285360212185170,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [
						{
							"id": "set-max-speed",
							"objectClass": "base",
							"sid": 879532816320765,
							"behaviorType": "mt",
							"parameters": {
								"max-speed": "Self.speedTotal+10"
							}
						},
						{
							"id": "set-speed",
							"objectClass": "base",
							"sid": 225815348458298,
							"behaviorType": "mt",
							"parameters": {
								"speed": "Self.speedTotal"
							}
						}
					],
					"sid": 584992272072690
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "basis",
							"sid": 493592156766988,
							"parameters": {
								"instance-variable": "move"
							}
						}
					],
					"actions": [
						{
							"id": "set-max-speed",
							"objectClass": "basis",
							"sid": 392744762604297,
							"behaviorType": "mt",
							"parameters": {
								"max-speed": "Self.speedTotal+10"
							}
						},
						{
							"id": "set-speed",
							"objectClass": "basis",
							"sid": 519698202405591,
							"behaviorType": "mt",
							"parameters": {
								"speed": "Self.speedTotal"
							}
						}
					],
					"sid": 711895783802445,
					"disabled": true
				}
			],
			"sid": 541321801084026
		}
	],
	"sid": 415764788921674
}