{
	"name": "_pfmth",
	"events": [
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-start-of-layout",
					"objectClass": "System",
					"sid": 725406189123442
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "aTools",
					"sid": 799267697152250,
					"parameters": {
						"instance-variable": "n",
						"comparison": 0,
						"value": "frame.n"
					}
				}
			],
			"actions": [
				{
					"id": "set-instvar-value",
					"objectClass": "ath",
					"sid": 610075742035204,
					"parameters": {
						"instance-variable": "speedGround",
						"value": "Self.speed*aBook.heroScaleCoeff"
					}
				},
				{
					"id": "add-obstacle",
					"objectClass": "ath",
					"sid": 695774565697377,
					"behaviorType": "losPfmt",
					"parameters": {
						"obstacle": "zoneStop"
					}
				},
				{
					"id": "add-obstacle",
					"objectClass": "ath",
					"sid": 476096561308913,
					"behaviorType": "losPfmt",
					"parameters": {
						"obstacle": "zoneStopTh"
					}
				}
			],
			"sid": 649897988629691,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "aTools",
							"sid": 554812042048105,
							"parameters": {
								"instance-variable": "directMT"
							},
							"isInverted": true
						}
					],
					"actions": [
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 240115155946950,
							"behaviorType": "pf",
							"parameters": {
								"obstacle": "zoneStop"
							}
						},
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 479168955365980,
							"behaviorType": "pf",
							"parameters": {
								"obstacle": "zoneStopTh"
							}
						}
					],
					"sid": 556198862626730
				}
			]
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "pfmth",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "trigger-once-while-true",
							"objectClass": "System",
							"sid": 254891567458050
						}
					],
					"actions": [
						{
							"type": "script",
							"language": "javascript",
							"script": [
								"init(runtime)"
							]
						},
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 792053715403399,
							"behaviorType": "losPfmt",
							"parameters": {
								"obstacle": "zoneStopTh"
							}
						},
						{
							"id": "add-obstacle",
							"objectClass": "ath",
							"sid": 570984214230474,
							"behaviorType": "losPfmt",
							"parameters": {
								"obstacle": "zoneStop"
							}
						}
					],
					"sid": 160798200132689,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "aTools",
									"sid": 692859346586769,
									"parameters": {
										"instance-variable": "directMT"
									},
									"isInverted": true
								}
							],
							"actions": [
								{
									"id": "add-obstacle",
									"objectClass": "ath",
									"sid": 661110652226368,
									"behaviorType": "pf",
									"parameters": {
										"obstacle": "zoneStopTh"
									}
								},
								{
									"id": "add-obstacle",
									"objectClass": "ath",
									"sid": 953321025565908,
									"behaviorType": "pf",
									"parameters": {
										"obstacle": "zoneStop"
									}
								}
							],
							"sid": 167006889120565
						}
					]
				},
				{
					"functionName": "smt",
					"functionDescription": "",
					"functionCategory": "_TOP",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "uid",
							"type": "number",
							"initialValue": "-1",
							"comment": "",
							"sid": 862181781561297
						},
						{
							"name": "goX",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 739803521123303
						},
						{
							"name": "goY",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 325677540925007
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 765886838919345,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-by-unique-id",
									"objectClass": "ath",
									"sid": 845667209220713,
									"parameters": {
										"unique-id": "uid"
									}
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "ath",
									"sid": 460716352649762,
									"parameters": {
										"instance-variable": "freeToGo"
									}
								}
							],
							"actions": [
								{
									"id": "append-text",
									"objectClass": "help",
									"sid": 457472717450275,
									"disabled": true,
									"parameters": {
										"text": "1"
									}
								}
							],
							"sid": 935586906948765,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "aTools",
											"sid": 978358551682583,
											"parameters": {
												"instance-variable": "directMT"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 301859725980715,
											"parameters": {
												"instance-variable": "goX",
												"value": "goX"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 938379130227386,
											"parameters": {
												"instance-variable": "goY",
												"value": "goY"
											}
										},
										{
											"id": "stop",
											"objectClass": "ath",
											"sid": 132684094021814,
											"disabled": true,
											"behaviorType": "mt"
										},
										{
											"callFunction": "scanPathAth",
											"sid": 430220807310930,
											"parameters": [
												"ath.UID",
												"ath.X",
												"ath.Y",
												"ath.goX",
												"ath.goY"
											]
										},
										{
											"id": "set-boolean-instvar",
											"objectClass": "ath",
											"sid": 264991992327485,
											"parameters": {
												"instance-variable": "startMove",
												"value": "true"
											}
										},
										{
											"id": "instance-signal",
											"objectClass": "ath",
											"sid": 156960483986759,
											"parameters": {
												"tag": "\"startMove\""
											}
										}
									],
									"sid": 589524331284168
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 473818025270641
										}
									],
									"actions": [
										{
											"id": "stop",
											"objectClass": "ath",
											"sid": 153641245249419,
											"behaviorType": "mt"
										},
										{
											"id": "find-path",
											"objectClass": "ath",
											"sid": 848577868837516,
											"behaviorType": "pf",
											"parameters": {
												"x": "goX=0? Mouse.X : goX",
												"y": "goY=0? Mouse.Y : goY"
											}
										}
									],
									"sid": 219964873613508
								}
							]
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Сканирование препятствий без поиска пути для терний",
					"background-color": [
						0.7803921568627451,
						0.8156862745098039,
						1,
						1
					]
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "pathScanAth",
					"description": "",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "comment",
							"text": ""
						},
						{
							"functionName": "scanPathAth",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": false,
							"functionIsAsync": false,
							"functionParameters": [
								{
									"name": "uid",
									"type": "number",
									"initialValue": "-1",
									"comment": "",
									"sid": 740860179230145
								},
								{
									"name": "startX",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 132617592583789
								},
								{
									"name": "startY",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 371176291472542
								},
								{
									"name": "targetX",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 504670365909457
								},
								{
									"name": "targetY",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"sid": 517326145535114
								}
							],
							"eventType": "function-block",
							"conditions": [
								{
									"id": "pick-by-unique-id",
									"objectClass": "ath",
									"sid": 635781600803689,
									"parameters": {
										"unique-id": "uid"
									}
								}
							],
							"actions": [],
							"sid": 333322221214140,
							"children": [
								{
									"eventType": "variable",
									"name": "targetAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Угол к цели",
									"isStatic": false,
									"isConstant": false,
									"sid": 386418312756128
								},
								{
									"eventType": "variable",
									"name": "targetDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция до цели",
									"isStatic": false,
									"isConstant": false,
									"sid": 830680073707319
								},
								{
									"eventType": "variable",
									"name": "mainUID",
									"type": "number",
									"initialValue": "0",
									"comment": "UID главного препятствия",
									"isStatic": false,
									"isConstant": false,
									"sid": 590196708393366
								},
								{
									"eventType": "variable",
									"name": "hitDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция до препятствия",
									"isStatic": false,
									"isConstant": false,
									"sid": 304821664999501
								},
								{
									"eventType": "variable",
									"name": "stepCoeff",
									"type": "number",
									"initialValue": "20",
									"comment": "Коэфф. шага (чем меньше, тем больше шаг)",
									"isStatic": false,
									"isConstant": false,
									"sid": 504549215401391
								},
								{
									"eventType": "variable",
									"name": "scanStep",
									"type": "number",
									"initialValue": "5",
									"comment": "Шаг сканирования в градусах",
									"isStatic": false,
									"isConstant": false,
									"sid": 208152299714479
								},
								{
									"eventType": "variable",
									"name": "lState",
									"type": "number",
									"initialValue": "0",
									"comment": "0: скан, 1: край, 2: блок",
									"isStatic": false,
									"isConstant": false,
									"sid": 651834758285774
								},
								{
									"eventType": "variable",
									"name": "rState",
									"type": "number",
									"initialValue": "0",
									"comment": "0: скан, 1: край, 2: блок",
									"isStatic": false,
									"isConstant": false,
									"sid": 626147282688996
								},
								{
									"eventType": "variable",
									"name": "lRayAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Угол последнего попадания",
									"isStatic": false,
									"isConstant": false,
									"sid": 457725733705757
								},
								{
									"eventType": "variable",
									"name": "rRayAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Угол последнего попадания",
									"isStatic": false,
									"isConstant": false,
									"sid": 651993619003167
								},
								{
									"eventType": "variable",
									"name": "lDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция до края",
									"isStatic": false,
									"isConstant": false,
									"sid": 424923418071798
								},
								{
									"eventType": "variable",
									"name": "rDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция до края",
									"isStatic": false,
									"isConstant": false,
									"sid": 449006830387998
								},
								{
									"eventType": "variable",
									"name": "lBlockDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция тупика",
									"isStatic": false,
									"isConstant": false,
									"sid": 417757595666857
								},
								{
									"eventType": "variable",
									"name": "rBlockDist",
									"type": "number",
									"initialValue": "0",
									"comment": "Дистанция тупика",
									"isStatic": false,
									"isConstant": false,
									"sid": 511982899849363
								},
								{
									"eventType": "variable",
									"name": "finalAng",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 319534809816018
								},
								{
									"eventType": "variable",
									"name": "finalDist",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 401477277433313
								},
								{
									"eventType": "variable",
									"name": "tempX",
									"type": "number",
									"initialValue": "0",
									"comment": "Временная точка на луче",
									"isStatic": false,
									"isConstant": false,
									"sid": 615454019312691
								},
								{
									"eventType": "variable",
									"name": "tempY",
									"type": "number",
									"initialValue": "0",
									"comment": "Временная точка на луче",
									"isStatic": false,
									"isConstant": false,
									"sid": 379306437531995
								},
								{
									"eventType": "variable",
									"name": "pushDir",
									"type": "number",
									"initialValue": "0",
									"comment": "Направление выталкивания (-1 лево, 1 право)",
									"isStatic": false,
									"isConstant": false,
									"sid": 358419139103951
								},
								{
									"eventType": "variable",
									"name": "travelAng",
									"type": "number",
									"initialValue": "0",
									"comment": "Текущее направление движения",
									"isStatic": false,
									"isConstant": false,
									"sid": 910173132483505
								},
								{
									"eventType": "variable",
									"name": "costL",
									"type": "number",
									"initialValue": "0",
									"comment": "Стоимость левого пути",
									"isStatic": false,
									"isConstant": false,
									"sid": 252262854348214
								},
								{
									"eventType": "variable",
									"name": "costR",
									"type": "number",
									"initialValue": "0",
									"comment": "Стоимость правого пути",
									"isStatic": false,
									"isConstant": false,
									"sid": 498529599454146
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 991392810998567,
											"parameters": {
												"variable": "targetAng",
												"value": "angle(startX, startY, targetX, targetY)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 840409016880376,
											"parameters": {
												"variable": "targetDist",
												"value": "distance(startX, startY, targetX, targetY)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 974499448317611,
											"parameters": {
												"variable": "travelAng",
												"value": "distance(ath.prevTargX, ath.prevTargY, startX, startY) > 5 ? angle(ath.prevTargX, ath.prevTargY, startX, startY) : targetAng"
											}
										},
										{
											"type": "comment",
											"text": "Пускаем луч чуть из-за спины, чтобы пробить коллизию, если мы уже внутри"
										},
										{
											"id": "cast-ray",
											"objectClass": "ath",
											"sid": 511788790073201,
											"behaviorType": "losPfmt",
											"parameters": {
												"from-x": "startX - cos(targetAng)*10",
												"from-y": "startY - sin(targetAng)*10",
												"to-x": "targetX",
												"to-y": "targetY",
												"use-collision-cells": true
											}
										}
									],
									"sid": 547067968268053,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "ray-intersected",
													"objectClass": "ath",
													"sid": 677765496189871,
													"behaviorType": "losPfmt"
												}
											],
											"actions": [
												{
													"type": "comment",
													"text": "Препятствие на линии. Запоминаем его UID и дистанцию."
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 707448487044093,
													"parameters": {
														"variable": "mainUID",
														"value": "ath.losPfmt.HitUID"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 972966878336004,
													"parameters": {
														"variable": "hitDist",
														"value": "ath.losPfmt.HitDistance"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 422094016672149,
													"parameters": {
														"variable": "lRayAng",
														"value": "targetAng"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 522202152735517,
													"parameters": {
														"variable": "rRayAng",
														"value": "targetAng"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 514514696813297,
													"parameters": {
														"variable": "lDist",
														"value": "ath.losPfmt.HitDistance"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 626059392788697,
													"parameters": {
														"variable": "rDist",
														"value": "ath.losPfmt.HitDistance"
													}
												}
											],
											"sid": 571400713835252
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 438247715670416,
													"parameters": {
														"variable": "mainUID",
														"comparison": 1,
														"value": "0"
													}
												}
											],
											"actions": [],
											"sid": 234571754576609,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 854910846639197,
															"parameters": {
																"variable": "hitDist",
																"comparison": 2,
																"value": "20"
															}
														}
													],
													"actions": [
														{
															"type": "comment",
															"text": "Слишком близко к стене. Просто отходим назад по лучу (с учетом изометрии).",
															"background-color": [
																0.33,
																0.73,
																0.48,
																1
															]
														},
														{
															"id": "set-boolean-instvar",
															"objectClass": "ath",
															"sid": 500406379354301,
															"parameters": {
																"instance-variable": "move",
																"value": "true"
															}
														},
														{
															"id": "set-boolean-instvar",
															"objectClass": "ath",
															"sid": 708401085589069,
															"parameters": {
																"instance-variable": "startMove",
																"value": "true"
															}
														},
														{
															"id": "instance-signal",
															"objectClass": "ath",
															"sid": 693333294404986,
															"parameters": {
																"tag": "\"startMove\""
															}
														},
														{
															"id": "move-to-position",
															"objectClass": "ath",
															"sid": 456712911295836,
															"behaviorType": "mt",
															"parameters": {
																"x": "float(tokenat(Functions.getPos(startX, startY, targetAng + 180, 40), 0, \";\"))",
																"y": "float(tokenat(Functions.getPos(startX, startY, targetAng + 180, 40), 1, \";\"))",
																"mode": "direct"
															}
														}
													],
													"sid": 301390146242621
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 806526364623850
														}
													],
													"actions": [
														{
															"type": "comment",
															"text": "Динамический шаг сканирования в зависимости от дистанции",
															"background-color": [
																0.33,
																0.73,
																0.48,
																1
															]
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 505815835251458,
															"parameters": {
																"variable": "scanStep",
																"value": "clamp(hitDist / stepCoeff, 1, 5)"
															}
														}
													],
													"sid": 798546237140427,
													"children": [
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "for",
																	"objectClass": "System",
																	"sid": 168054728083684,
																	"parameters": {
																		"name": "\"scan\"",
																		"start-index": "1",
																		"end-index": "ceil(180 / scanStep)"
																	}
																}
															],
															"actions": [],
															"sid": 815965696857116,
															"children": [
																{
																	"eventType": "comment",
																	"text": "--- ЛЕВАЯ СТОРОНА ---",
																	"background-color": [
																		0.49,
																		0.7,
																		0.38,
																		1
																	]
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 227316461022903,
																			"parameters": {
																				"variable": "lState",
																				"comparison": 0,
																				"value": "0"
																			}
																		}
																	],
																	"actions": [
																		{
																			"id": "cast-ray",
																			"objectClass": "ath",
																			"sid": 238077319074332,
																			"behaviorType": "losPfmt",
																			"parameters": {
																				"from-x": "startX - cos(targetAng)*10",
																				"from-y": "startY - sin(targetAng)*10",
																				"to-x": "startX + cos(targetAng - loopindex * scanStep) * 2000",
																				"to-y": "startY + sin(targetAng - loopindex * scanStep) * 2000",
																				"use-collision-cells": true
																			}
																		}
																	],
																	"sid": 478033066416114,
																	"children": [
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "ray-intersected",
																					"objectClass": "ath",
																					"sid": 267358853450155,
																					"behaviorType": "losPfmt"
																				}
																			],
																			"actions": [],
																			"sid": 454340986521429,
																			"children": [
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "compare-two-values",
																							"objectClass": "System",
																							"sid": 570948693177976,
																							"parameters": {
																								"first-value": "ath.losPfmt.HitUID",
																								"comparison": 0,
																								"second-value": "mainUID"
																							}
																						}
																					],
																					"actions": [
																						{
																							"type": "comment",
																							"text": "Всё ещё наше препятствие. Обновляем крайние точки."
																						},
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 766381903817205,
																							"parameters": {
																								"variable": "lRayAng",
																								"value": "targetAng - loopindex * scanStep"
																							}
																						},
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 213709812458049,
																							"parameters": {
																								"variable": "lDist",
																								"value": "ath.losPfmt.HitDistance"
																							}
																						}
																					],
																					"sid": 671946997169858
																				},
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "else",
																							"objectClass": "System",
																							"sid": 565404072216470
																						}
																					],
																					"actions": [],
																					"sid": 843196490235437,
																					"children": [
																						{
																							"eventType": "block",
																							"conditions": [
																								{
																									"id": "compare-two-values",
																									"objectClass": "System",
																									"sid": 249880030137544,
																									"parameters": {
																										"first-value": "ath.losPfmt.HitDistance",
																										"comparison": 2,
																										"second-value": "lDist + 20"
																									}
																								}
																							],
																							"actions": [
																								{
																									"type": "comment",
																									"text": "Наткнулись на другое препятствие БЛИЖЕ. Сторона заблокирована."
																								},
																								{
																									"id": "set-eventvar-value",
																									"objectClass": "System",
																									"sid": 861204714081600,
																									"parameters": {
																										"variable": "lState",
																										"value": "2"
																									}
																								},
																								{
																									"id": "set-eventvar-value",
																									"objectClass": "System",
																									"sid": 208216581705141,
																									"parameters": {
																										"variable": "lBlockDist",
																										"value": "ath.losPfmt.HitDistance"
																									}
																								}
																							],
																							"sid": 105623919545646
																						},
																						{
																							"eventType": "block",
																							"conditions": [
																								{
																									"id": "else",
																									"objectClass": "System",
																									"sid": 718562654567220
																								}
																							],
																							"actions": [
																								{
																									"type": "comment",
																									"text": "Другое препятствие ДАЛЬШЕ. Значит мы нашли край."
																								},
																								{
																									"id": "set-eventvar-value",
																									"objectClass": "System",
																									"sid": 597891083311421,
																									"parameters": {
																										"variable": "lState",
																										"value": "1"
																									}
																								}
																							],
																							"sid": 518539276741978
																						}
																					]
																				}
																			]
																		},
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "else",
																					"objectClass": "System",
																					"sid": 493564792725913
																				}
																			],
																			"actions": [
																				{
																					"type": "comment",
																					"text": "Луч прошел свободно. Край найден."
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 894414490911810,
																					"parameters": {
																						"variable": "lState",
																						"value": "1"
																					}
																				}
																			],
																			"sid": 275922548576917
																		}
																	]
																},
																{
																	"eventType": "comment",
																	"text": "--- ПРАВАЯ СТОРОНА ---",
																	"background-color": [
																		0.49,
																		0.7,
																		0.38,
																		1
																	]
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 703504088684548,
																			"parameters": {
																				"variable": "rState",
																				"comparison": 0,
																				"value": "0"
																			}
																		}
																	],
																	"actions": [
																		{
																			"id": "cast-ray",
																			"objectClass": "ath",
																			"sid": 112589091040201,
																			"behaviorType": "losPfmt",
																			"parameters": {
																				"from-x": "startX - cos(targetAng)*10",
																				"from-y": "startY - sin(targetAng)*10",
																				"to-x": "startX + cos(targetAng + loopindex * scanStep) * 2000",
																				"to-y": "startY + sin(targetAng + loopindex * scanStep) * 2000",
																				"use-collision-cells": true
																			}
																		}
																	],
																	"sid": 952703303522657,
																	"children": [
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "ray-intersected",
																					"objectClass": "ath",
																					"sid": 486305049238362,
																					"behaviorType": "losPfmt"
																				}
																			],
																			"actions": [],
																			"sid": 338323989047529,
																			"children": [
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "compare-two-values",
																							"objectClass": "System",
																							"sid": 278136187955110,
																							"parameters": {
																								"first-value": "ath.losPfmt.HitUID",
																								"comparison": 0,
																								"second-value": "mainUID"
																							}
																						}
																					],
																					"actions": [
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 566003196900566,
																							"parameters": {
																								"variable": "rRayAng",
																								"value": "targetAng + loopindex * scanStep"
																							}
																						},
																						{
																							"id": "set-eventvar-value",
																							"objectClass": "System",
																							"sid": 885344744408109,
																							"parameters": {
																								"variable": "rDist",
																								"value": "ath.losPfmt.HitDistance"
																							}
																						}
																					],
																					"sid": 198388960160027
																				},
																				{
																					"eventType": "block",
																					"conditions": [
																						{
																							"id": "else",
																							"objectClass": "System",
																							"sid": 617196545885967
																						}
																					],
																					"actions": [],
																					"sid": 717863963026989,
																					"children": [
																						{
																							"eventType": "block",
																							"conditions": [
																								{
																									"id": "compare-two-values",
																									"objectClass": "System",
																									"sid": 163702943444077,
																									"parameters": {
																										"first-value": "ath.losPfmt.HitDistance",
																										"comparison": 2,
																										"second-value": "rDist + 20"
																									}
																								}
																							],
																							"actions": [
																								{
																									"id": "set-eventvar-value",
																									"objectClass": "System",
																									"sid": 255053316530140,
																									"parameters": {
																										"variable": "rState",
																										"value": "2"
																									}
																								},
																								{
																									"id": "set-eventvar-value",
																									"objectClass": "System",
																									"sid": 777458389285758,
																									"parameters": {
																										"variable": "rBlockDist",
																										"value": "ath.losPfmt.HitDistance"
																									}
																								}
																							],
																							"sid": 562728351385319
																						},
																						{
																							"eventType": "block",
																							"conditions": [
																								{
																									"id": "else",
																									"objectClass": "System",
																									"sid": 644163705443954
																								}
																							],
																							"actions": [
																								{
																									"id": "set-eventvar-value",
																									"objectClass": "System",
																									"sid": 494534600281927,
																									"parameters": {
																										"variable": "rState",
																										"value": "1"
																									}
																								}
																							],
																							"sid": 206675082773613
																						}
																					]
																				}
																			]
																		},
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "else",
																					"objectClass": "System",
																					"sid": 348264153979566
																				}
																			],
																			"actions": [
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 204140921525493,
																					"parameters": {
																						"variable": "rState",
																						"value": "1"
																					}
																				}
																			],
																			"sid": 866636673564919
																		}
																	]
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 239333197097718,
																			"parameters": {
																				"variable": "lState",
																				"comparison": 1,
																				"value": "0"
																			}
																		},
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 573465835335869,
																			"parameters": {
																				"variable": "rState",
																				"comparison": 1,
																				"value": "0"
																			}
																		}
																	],
																	"actions": [
																		{
																			"type": "comment",
																			"text": "Обе стороны завершили сканирование. Прерываем цикл."
																		},
																		{
																			"id": "stop-loop",
																			"objectClass": "System",
																			"sid": 439661319076651
																		}
																	],
																	"sid": 862829867976481
																}
															]
														},
														{
															"eventType": "comment",
															"text": "--- АНАЛИЗ РЕЗУЛЬТАТОВ СКАНИРОВАНИЯ ---",
															"background-color": [
																0.33,
																0.73,
																0.48,
																1
															]
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "compare-eventvar",
																	"objectClass": "System",
																	"sid": 442947955964899,
																	"parameters": {
																		"variable": "lState",
																		"comparison": 0,
																		"value": "2"
																	}
																},
																{
																	"id": "compare-eventvar",
																	"objectClass": "System",
																	"sid": 723153897882560,
																	"parameters": {
																		"variable": "rState",
																		"comparison": 0,
																		"value": "2"
																	}
																}
															],
															"actions": [
																{
																	"type": "comment",
																	"text": "Обе стороны заблокированы. Идем напролом.",
																	"background-color": [
																		0.33,
																		0.73,
																		0.48,
																		1
																	]
																},
																{
																	"id": "set-boolean-instvar",
																	"objectClass": "ath",
																	"sid": 727588906448670,
																	"parameters": {
																		"instance-variable": "move",
																		"value": "true"
																	}
																},
																{
																	"id": "set-boolean-instvar",
																	"objectClass": "ath",
																	"sid": 376405874509560,
																	"parameters": {
																		"instance-variable": "startMove",
																		"value": "true"
																	}
																},
																{
																	"id": "instance-signal",
																	"objectClass": "ath",
																	"sid": 727112611385895,
																	"parameters": {
																		"tag": "\"startMove\""
																	}
																},
																{
																	"id": "move-to-position",
																	"objectClass": "ath",
																	"sid": 797069306485206,
																	"behaviorType": "mt",
																	"parameters": {
																		"x": "startX + cos(targetAng) * (max(lBlockDist, rBlockDist) + 40)",
																		"y": "startY + sin(targetAng) * (max(lBlockDist, rBlockDist) + 40)",
																		"mode": "direct"
																	}
																}
															],
															"sid": 274826974133372
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "else",
																	"objectClass": "System",
																	"sid": 930669787131828
																}
															],
															"actions": [],
															"sid": 277069911751087,
															"children": [
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 323563807522078,
																			"parameters": {
																				"variable": "lState",
																				"comparison": 0,
																				"value": "1"
																			}
																		},
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 487596142828960,
																			"parameters": {
																				"variable": "rState",
																				"comparison": 0,
																				"value": "2"
																			}
																		}
																	],
																	"actions": [
																		{
																			"type": "comment",
																			"text": "Право заблокировано, идем влево.",
																			"background-color": [
																				0.33,
																				0.73,
																				0.48,
																				1
																			]
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 685909556040230,
																			"parameters": {
																				"variable": "finalAng",
																				"value": "lRayAng - scanStep"
																			}
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 617075999877652,
																			"parameters": {
																				"variable": "finalDist",
																				"value": "lDist"
																			}
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 652803776496518,
																			"parameters": {
																				"variable": "pushDir",
																				"value": "-1"
																			}
																		}
																	],
																	"sid": 620083325668915
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 920661708372162,
																			"parameters": {
																				"variable": "rState",
																				"comparison": 0,
																				"value": "1"
																			}
																		},
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 990398885281036,
																			"parameters": {
																				"variable": "lState",
																				"comparison": 0,
																				"value": "2"
																			}
																		}
																	],
																	"actions": [
																		{
																			"type": "comment",
																			"text": "Лево заблокировано, идем вправо.",
																			"background-color": [
																				0.33,
																				0.73,
																				0.48,
																				1
																			]
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 737028209900127,
																			"parameters": {
																				"variable": "finalAng",
																				"value": "rRayAng + scanStep"
																			}
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 458792200570810,
																			"parameters": {
																				"variable": "finalDist",
																				"value": "rDist"
																			}
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 252952831359220,
																			"parameters": {
																				"variable": "pushDir",
																				"value": "1"
																			}
																		}
																	],
																	"sid": 274231325273789
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 523694460816428,
																			"parameters": {
																				"variable": "lState",
																				"comparison": 0,
																				"value": "1"
																			}
																		},
																		{
																			"id": "compare-eventvar",
																			"objectClass": "System",
																			"sid": 300632536932402,
																			"parameters": {
																				"variable": "rState",
																				"comparison": 0,
																				"value": "1"
																			}
																		}
																	],
																	"actions": [
																		{
																			"type": "comment",
																			"text": "Обе стороны свободны. Считаем реальную длину пути (A* эвристика).",
																			"background-color": [
																				0.33,
																				0.73,
																				0.48,
																				1
																			]
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 425064564911092,
																			"parameters": {
																				"variable": "costL",
																				"value": "lDist + distance(startX + cos(lRayAng - scanStep) * lDist, startY + sin(lRayAng - scanStep) * lDist, targetX, targetY) + abs(anglediff(travelAng, lRayAng - scanStep)) * 2"
																			}
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 745208082942950,
																			"parameters": {
																				"variable": "costR",
																				"value": "rDist + distance(startX + cos(rRayAng + scanStep) * rDist, startY + sin(rRayAng + scanStep) * rDist, targetX, targetY) + abs(anglediff(travelAng, rRayAng + scanStep)) * 2"
																			}
																		}
																	],
																	"sid": 917588100163315,
																	"children": [
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "compare-two-values",
																					"objectClass": "System",
																					"sid": 222180700741010,
																					"parameters": {
																						"first-value": "costL",
																						"comparison": 2,
																						"second-value": "costR"
																					}
																				}
																			],
																			"actions": [
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 703709829300685,
																					"parameters": {
																						"variable": "finalAng",
																						"value": "lRayAng - scanStep"
																					}
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 207054271179987,
																					"parameters": {
																						"variable": "finalDist",
																						"value": "lDist"
																					}
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 157953013054460,
																					"parameters": {
																						"variable": "pushDir",
																						"value": "-1"
																					}
																				}
																			],
																			"sid": 286721089463091
																		},
																		{
																			"eventType": "block",
																			"conditions": [
																				{
																					"id": "else",
																					"objectClass": "System",
																					"sid": 476043613466042
																				}
																			],
																			"actions": [
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 592491909747446,
																					"parameters": {
																						"variable": "finalAng",
																						"value": "rRayAng + scanStep"
																					}
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 721594016062281,
																					"parameters": {
																						"variable": "finalDist",
																						"value": "rDist"
																					}
																				},
																				{
																					"id": "set-eventvar-value",
																					"objectClass": "System",
																					"sid": 411748415575381,
																					"parameters": {
																						"variable": "pushDir",
																						"value": "1"
																					}
																				}
																			],
																			"sid": 458810071400482
																		}
																	]
																},
																{
																	"eventType": "block",
																	"conditions": [],
																	"actions": [
																		{
																			"type": "comment",
																			"text": "1. Находим точку на чистом луче (с запасом 50px для обхода угла).",
																			"background-color": [
																				0.33,
																				0.73,
																				0.48,
																				1
																			]
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 870128166466169,
																			"parameters": {
																				"variable": "tempX",
																				"value": "startX + cos(finalAng) * min(finalDist + 50, targetDist)"
																			}
																		},
																		{
																			"id": "set-eventvar-value",
																			"objectClass": "System",
																			"sid": 807669584135733,
																			"parameters": {
																				"variable": "tempY",
																				"value": "startY + sin(finalAng) * min(finalDist + 50, targetDist)"
																			}
																		},
																		{
																			"type": "comment",
																			"text": "2. Сдвигаем эту точку перпендикулярно лучу на 50px (с учетом изометрии!).",
																			"background-color": [
																				0.33,
																				0.73,
																				0.48,
																				1
																			]
																		},
																		{
																			"id": "set-boolean-instvar",
																			"objectClass": "ath",
																			"sid": 502894038743665,
																			"parameters": {
																				"instance-variable": "move",
																				"value": "true"
																			}
																		},
																		{
																			"id": "set-boolean-instvar",
																			"objectClass": "ath",
																			"sid": 881011859314173,
																			"parameters": {
																				"instance-variable": "startMove",
																				"value": "true"
																			}
																		},
																		{
																			"id": "instance-signal",
																			"objectClass": "ath",
																			"sid": 651838422530724,
																			"parameters": {
																				"tag": "\"startMove\""
																			}
																		},
																		{
																			"id": "move-to-position",
																			"objectClass": "ath",
																			"sid": 350183184774173,
																			"behaviorType": "mt",
																			"parameters": {
																				"x": "float(tokenat(Functions.getPos(tempX, tempY, finalAng + 90 * pushDir, 50), 0, \";\"))",
																				"y": "float(tokenat(Functions.getPos(tempX, tempY, finalAng + 90 * pushDir, 50), 1, \";\"))",
																				"mode": "direct"
																			}
																		}
																	],
																	"sid": 548403901633141
																}
															]
														}
													]
												}
											]
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 931033182606664
												}
											],
											"actions": [
												{
													"type": "comment",
													"text": "Путь чист. Идем напрямую к цели."
												},
												{
													"id": "set-boolean-instvar",
													"objectClass": "ath",
													"sid": 693641110935412,
													"parameters": {
														"instance-variable": "move",
														"value": "true"
													}
												},
												{
													"id": "set-boolean-instvar",
													"objectClass": "ath",
													"sid": 603519520762640,
													"parameters": {
														"instance-variable": "startMove",
														"value": "true"
													}
												},
												{
													"id": "instance-signal",
													"objectClass": "ath",
													"sid": 872569744676355,
													"parameters": {
														"tag": "\"startMove\""
													}
												},
												{
													"id": "move-to-position",
													"objectClass": "ath",
													"sid": 279993673934652,
													"behaviorType": "mt",
													"parameters": {
														"x": "ath.goX",
														"y": "ath.goY",
														"mode": "direct"
													}
												}
											],
											"sid": 804589633782729
										}
									]
								}
							]
						}
					],
					"sid": 352439261827993
				},
				{
					"eventType": "comment",
					"text": "",
					"background-color": [
						0.7803921568627451,
						0.8156862745098039,
						1,
						1
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-path-found",
							"objectClass": "ath",
							"sid": 802690257358466,
							"behaviorType": "pf"
						}
					],
					"actions": [
						{
							"id": "cast-ray",
							"objectClass": "ath",
							"sid": 804512572459901,
							"behaviorType": "losPfmt",
							"parameters": {
								"from-x": "Self.X",
								"from-y": "Self.Y",
								"to-x": "Self.pf.NodeXAt(Self.pf.NodeCount-1)",
								"to-y": "Self.pf.NodeYAt(Self.pf.NodeCount-1)",
								"use-collision-cells": true
							}
						}
					],
					"sid": 221110511325530,
					"children": [
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "set-boolean-instvar",
									"objectClass": "ath",
									"sid": 805573059344163,
									"parameters": {
										"instance-variable": "move",
										"value": "true"
									}
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "ath",
									"sid": 260909448402860,
									"parameters": {
										"instance-variable": "startMove",
										"value": "true"
									}
								},
								{
									"id": "instance-signal",
									"objectClass": "ath",
									"sid": 598410953767139,
									"parameters": {
										"tag": "\"startMove\""
									}
								}
							],
							"sid": 761599080001884
						},
						{
							"eventType": "variable",
							"name": "lx",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 557048706658558
						},
						{
							"eventType": "variable",
							"name": "ly",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 493765773837938
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 656640200443953,
									"parameters": {
										"variable": "lx",
										"value": "round(ath.X)"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 308922921788856,
									"parameters": {
										"variable": "ly",
										"value": "round(ath.Y)"
									}
								}
							],
							"sid": 809857935745746
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "repeat",
									"objectClass": "System",
									"sid": 273844177979833,
									"parameters": {
										"count": "ath.pf.NodeCount"
									}
								}
							],
							"actions": [
								{
									"id": "cast-ray",
									"objectClass": "ath",
									"sid": 898538246464524,
									"behaviorType": "losPfmt",
									"parameters": {
										"from-x": "lx",
										"from-y": "ly",
										"to-x": "ath.pf.NodeXAt(loopindex)",
										"to-y": "ath.pf.NodeYAt(loopindex)",
										"use-collision-cells": true
									}
								}
							],
							"sid": 540353051937594,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "ray-intersected",
											"objectClass": "ath",
											"sid": 597090205573102,
											"behaviorType": "losPfmt"
										}
									],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 376762489358951,
											"parameters": {
												"variable": "lx",
												"value": "ath.pf.NodeXAt(loopindex-1)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 904010491902122,
											"parameters": {
												"variable": "ly",
												"value": "ath.pf.NodeYAt(loopindex-1)"
											}
										},
										{
											"id": "move-to-position",
											"objectClass": "ath",
											"sid": 329855247626085,
											"behaviorType": "mt",
											"parameters": {
												"x": "lx",
												"y": "ly",
												"mode": "add-waypoint"
											}
										},
										{
											"id": "set-boolean-instvar",
											"objectClass": "ath",
											"sid": 895305767233558,
											"parameters": {
												"instance-variable": "startMove",
												"value": "false"
											}
										}
									],
									"sid": 590459876431816
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "move-to-position",
									"objectClass": "ath",
									"sid": 967793655758367,
									"behaviorType": "mt",
									"parameters": {
										"x": "ath.pf.NodeXAt(ath.pf.NodeCount-1)",
										"y": "ath.pf.NodeYAt(ath.pf.NodeCount-1)",
										"mode": "add-waypoint"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "ath",
									"sid": 106206158143709,
									"parameters": {
										"instance-variable": "prevTargX",
										"value": "lx"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "ath",
									"sid": 945785114871782,
									"parameters": {
										"instance-variable": "prevTargY",
										"value": "ly"
									}
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "ath",
									"sid": 285978552455860,
									"parameters": {
										"instance-variable": "startMove",
										"value": "true"
									}
								}
							],
							"sid": 248975318031420
						}
					]
				},
				{
					"eventType": "comment",
					"text": "",
					"background-color": [
						0.7803921568627451,
						0.8156862745098039,
						1,
						1
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-arrived",
							"objectClass": "ath",
							"sid": 154728489008695,
							"behaviorType": "mt"
						}
					],
					"actions": [],
					"sid": 617859570559005,
					"children": [
						{
							"eventType": "comment",
							"text": "    финишная прямая, булева проверки расстояния для финишной телепортации"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-moving",
									"objectClass": "ath",
									"sid": 928865640813210,
									"disabled": true,
									"behaviorType": "mt"
								},
								{
									"id": "compare-speed",
									"objectClass": "ath",
									"sid": 695492455705358,
									"behaviorType": "mt",
									"parameters": {
										"comparison": 4,
										"speed": "10"
									}
								}
							],
							"actions": [],
							"sid": 153310232496700,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 909717077848666,
											"parameters": {
												"first-value": "int(ath.X)",
												"comparison": 0,
												"second-value": "int(ath.prevTargX)"
											}
										},
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 586819229145564,
											"parameters": {
												"first-value": "int(ath.Y)",
												"comparison": 0,
												"second-value": "int(ath.prevTargY)"
											}
										}
									],
									"actions": [
										{
											"type": "comment",
											"text": "? действие разрешающее телепортацию или атаку"
										}
									],
									"sid": 351233397882687
								}
							]
						},
						{
							"eventType": "comment",
							"text": "    точка назначения"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 916578673697851
								},
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 152909359122739,
									"disabled": true,
									"parameters": {
										"first-value": "ath.pf.NodeXAt(ath.pf.NodeCount)",
										"comparison": 0,
										"second-value": "0"
									}
								}
							],
							"actions": [],
							"sid": 156856179015087,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "aTools",
											"sid": 463652015834650,
											"parameters": {
												"instance-variable": "directMT"
											}
										},
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 185009685544394,
											"parameters": {
												"first-value": "distance(ath.X, ath.Y, ath.goX, ath.goY)",
												"comparison": 4,
												"second-value": "10"
											}
										}
									],
									"actions": [
										{
											"type": "comment",
											"text": "Мы пришли в точку обхода, но до финиша (goX/goY) еще больше 10 пикселей. Сканируем путь дальше!"
										},
										{
											"callFunction": "scanPathAth",
											"sid": 722874475015851,
											"parameters": [
												"ath.UID",
												"ath.X",
												"ath.Y",
												"ath.goX",
												"ath.goY"
											]
										}
									],
									"sid": 175038643798240
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 470532965389156
										}
									],
									"actions": [
										{
											"id": "instance-signal",
											"objectClass": "ath",
											"sid": 834833643628214,
											"disabled": true,
											"parameters": {
												"tag": "\"stop\""
											}
										},
										{
											"callFunction": "stopThorns",
											"sid": 770204734468980,
											"parameters": [
												"ath.UID",
												true
											]
										}
									],
									"sid": 118166240067656
								}
							]
						}
					]
				},
				{
					"eventType": "comment",
					"text": "",
					"background-color": [
						0.7803921568627451,
						0.8156862745098039,
						1,
						1
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-instance-signal",
							"objectClass": "ath",
							"sid": 431762781443719,
							"parameters": {
								"tag": "\"stop\""
							}
						}
					],
					"actions": [
						{
							"callFunction": "stopThorns",
							"sid": 192217599554387,
							"parameters": [
								"ath.UID",
								true
							]
						}
					],
					"sid": 577621961557639,
					"disabled": true
				},
				{
					"eventType": "comment",
					"text": "",
					"background-color": [
						0.7803921568627451,
						0.8156862745098039,
						1,
						1
					]
				},
				{
					"functionName": "stopThorns",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "uid",
							"type": "number",
							"initialValue": "-1",
							"comment": "",
							"sid": 312527279599885
						},
						{
							"name": "signal",
							"type": "boolean",
							"initialValue": "true",
							"comment": "",
							"sid": 246100973421457
						}
					],
					"eventType": "function-block",
					"conditions": [
						{
							"id": "pick-by-unique-id",
							"objectClass": "ath",
							"sid": 194984573403765,
							"parameters": {
								"unique-id": "uid"
							}
						}
					],
					"actions": [
						{
							"id": "stop",
							"objectClass": "ath",
							"sid": 506835882012710,
							"behaviorType": "pf"
						},
						{
							"id": "stop",
							"objectClass": "ath",
							"sid": 283468234330889,
							"behaviorType": "mt"
						},
						{
							"id": "set-boolean-instvar",
							"objectClass": "ath",
							"sid": 433174622730256,
							"parameters": {
								"instance-variable": "move",
								"value": "false"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "ath",
							"sid": 635060697016898,
							"parameters": {
								"instance-variable": "stateAth",
								"value": "\"stop\""
							}
						},
						{
							"id": "instance-signal",
							"objectClass": "ath",
							"sid": 235218411326446,
							"disabled": true,
							"parameters": {
								"tag": "\"stopAth\""
							}
						},
						{
							"id": "stop-animation",
							"objectClass": "ath",
							"sid": 156709241316343,
							"disabled": true
						}
					],
					"sid": 672919537145415,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 620826695490723,
									"parameters": {
										"variable": "signal"
									}
								}
							],
							"actions": [
								{
									"id": "instance-signal",
									"objectClass": "ath",
									"sid": 418955821501656,
									"parameters": {
										"tag": "\"stop\"&ath.name"
									}
								},
								{
									"id": "instance-signal",
									"objectClass": "ath",
									"sid": 458038664656551,
									"parameters": {
										"tag": "\"stop\"&ath.UID"
									}
								}
							],
							"sid": 233702024200873
						}
					]
				},
				{
					"eventType": "comment",
					"text": "    выталкивание из препятствия"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-failed-to-find-path",
							"objectClass": "ath",
							"sid": 137185527737339,
							"behaviorType": "pf"
						},
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "ath",
							"sid": 962587873690800,
							"parameters": {
								"instance-variable": "pushAbil"
							}
						}
					],
					"actions": [],
					"sid": 556515921484923,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-overlapping-another-object",
									"objectClass": "ath",
									"sid": 859683611534577,
									"parameters": {
										"object": "zoneStop"
									}
								}
							],
							"actions": [
								{
									"id": "move-to-position",
									"objectClass": "ath",
									"sid": 506047547453164,
									"behaviorType": "mt",
									"parameters": {
										"x": "Self.X+10*cos(angle(zoneStop.X,zoneStop.Y,ath.X,ath.Y))",
										"y": "Self.Y+10*sin(angle(zoneStop.X,zoneStop.Y,ath.X,ath.Y))",
										"mode": "direct"
									}
								}
							],
							"sid": 241858320404374
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-overlapping-another-object",
									"objectClass": "ath",
									"sid": 732390441443827,
									"parameters": {
										"object": "zoneStopTh"
									}
								}
							],
							"actions": [
								{
									"id": "move-to-position",
									"objectClass": "ath",
									"sid": 178692381338065,
									"behaviorType": "mt",
									"parameters": {
										"x": "Self.X+10*cos(angle(zoneStop.X,zoneStopTh.Y,ath.X,ath.Y))",
										"y": "Self.Y+10*sin(angle(zoneStop.X,zoneStopTh.Y,ath.X,ath.Y))",
										"mode": "direct"
									}
								}
							],
							"sid": 266720040313926
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "aTools",
							"sid": 695361377778807,
							"parameters": {
								"instance-variable": "directMT"
							}
						}
					],
					"actions": [],
					"sid": 770891295702414,
					"disabled": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-collision-with-another-object",
									"objectClass": "ath",
									"sid": 222769954241895,
									"parameters": {
										"object": "zoneStop"
									}
								}
							],
							"actions": [
								{
									"id": "move-to-position",
									"objectClass": "ath",
									"sid": 803066989483626,
									"behaviorType": "mt",
									"parameters": {
										"x": "Self.X+10*cos(angle(zoneStop.X,zoneStop.Y,ath.X,ath.Y))",
										"y": "Self.Y+10*sin(angle(zoneStop.X,zoneStop.Y,ath.X,ath.Y))",
										"mode": "direct"
									}
								}
							],
							"sid": 780588585029002,
							"disabled": true
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-collision-with-another-object",
									"objectClass": "ath",
									"sid": 322374357297594,
									"parameters": {
										"object": "zoneStopTh"
									}
								}
							],
							"actions": [
								{
									"id": "move-to-position",
									"objectClass": "ath",
									"sid": 554000255653293,
									"behaviorType": "mt",
									"parameters": {
										"x": "Self.X+10*cos(angle(zoneStop.X,zoneStopTh.Y,ath.X,ath.Y))",
										"y": "Self.Y+10*sin(angle(zoneStop.X,zoneStopTh.Y,ath.X,ath.Y))",
										"mode": "direct"
									}
								}
							],
							"sid": 538156162358176,
							"disabled": true
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Поворот терний. Чтобы повернуться к герою, отправить x=0"
				},
				{
					"aceType": "action",
					"aceName": "thRotate",
					"objectClass": "ats",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "athBaseUID",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 400600339745201
						},
						{
							"name": "x",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 500586470347768
						},
						{
							"name": "y",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"sid": 752845259483097
						},
						{
							"name": "dirMirroring",
							"type": "boolean",
							"initialValue": "false",
							"comment": "",
							"sid": 699710494061791
						},
						{
							"name": "basisUID",
							"type": "number",
							"initialValue": "-1",
							"comment": "",
							"sid": 248868407949532
						}
					],
					"eventType": "custom-ace-block",
					"conditions": [
						{
							"id": "pick-by-unique-id",
							"objectClass": "ath",
							"sid": 474899905271713,
							"parameters": {
								"unique-id": "athBaseUID"
							}
						}
					],
					"actions": [],
					"sid": 158113244356277,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 290335785359413,
									"parameters": {
										"variable": "basisUID",
										"comparison": 1,
										"value": "-1"
									}
								},
								{
									"id": "pick-by-unique-id",
									"objectClass": "basis",
									"sid": 180720053665575,
									"parameters": {
										"unique-id": "basis.UID"
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 894252839351027,
									"parameters": {
										"variable": "x",
										"value": "basis.X"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 648963983619637,
									"parameters": {
										"variable": "y",
										"value": "basis.Y"
									}
								}
							],
							"sid": 959013244906589
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 351440171862576
								},
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 363414066776243,
									"parameters": {
										"variable": "x",
										"comparison": 0,
										"value": "0"
									}
								},
								{
									"id": "compare-instance-variable",
									"objectClass": "basis",
									"sid": 798235846499827,
									"parameters": {
										"instance-variable": "name",
										"comparison": 0,
										"value": "aBook.hero"
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 255228993975792,
									"parameters": {
										"variable": "x",
										"value": "basis.X"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 245941291719268,
									"parameters": {
										"variable": "y",
										"value": "basis.Y"
									}
								}
							],
							"sid": 414359858690312
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "ath",
									"sid": 990142345898675,
									"parameters": {
										"instance-variable": "vAng",
										"value": "angle(ath.X,ath.Y,x,y)"
									}
								}
							],
							"sid": 251163521296631
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 505278104345907,
									"parameters": {
										"variable": "dirMirroring"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "ath",
									"sid": 115031151609871,
									"parameters": {
										"instance-variable": "direct",
										"value": "int(((Self.vAng+360+22.5) %360)/45)"
									}
								},
								{
									"id": "set-mirrored",
									"objectClass": "tChick",
									"sid": 146633494124117,
									"parameters": {
										"state": "not-mirrored"
									}
								}
							],
							"sid": 203020376499705,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-between-values",
											"objectClass": "System",
											"sid": 141647939430038,
											"parameters": {
												"value": "ath.direct",
												"lower-bound": "3",
												"upper-bound": "5"
											}
										}
									],
									"actions": [
										{
											"id": "set-mirrored",
											"objectClass": "tChick",
											"sid": 566627032785068,
											"parameters": {
												"state": "mirrored"
											}
										}
									],
									"sid": 977431239951473
								}
							]
						}
					]
				},
				{
					"eventType": "comment",
					"text": "",
					"background-color": [
						0.7803921568627451,
						0.8156862745098039,
						1,
						1
					]
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "speedIso",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "ath",
									"sid": 657895236763271,
									"parameters": {
										"instance-variable": "move"
									}
								}
							],
							"actions": [],
							"sid": 449942799135549,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "ath",
											"sid": 733704892351763,
											"parameters": {
												"instance-variable": "totem",
												"comparison": 1,
												"value": "\"serpent\""
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 377808526062552,
											"parameters": {
												"instance-variable": "ang",
												"value": "round(Self.Angle-360*floor(Self.Angle/360))"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 857463825991697,
											"parameters": {
												"instance-variable": "angZ",
												"value": "(Self.ang>90)&(Self.ang<=270)?atan(tan(Self.ang)/aTools.isoCoeff)+180:atan(tan(Self.ang)/aTools.isoCoeff)"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 200627226708590,
											"parameters": {
												"instance-variable": "speedZ",
												"value": "Self.ang=90 | Self.ang=270 ? round(Self.speedGround*aTools.isoCoeff) : round(Self.speedGround*cos(Self.angZ)/cos(Self.ang))"
											}
										},
										{
											"id": "fill-ellipse",
											"objectClass": "DrawingCanvas",
											"sid": 430495716937730,
											"disabled": true,
											"parameters": {
												"x": "basis.X",
												"y": "basis.Y",
												"radius-x": "0.5",
												"radius-y": "0.5",
												"color": "rgba(0, 0, 0, 100)",
												"edge": "smooth"
											}
										}
									],
									"sid": 653978205945228
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "ath",
											"sid": 336119396480093,
											"parameters": {
												"instance-variable": "totem",
												"comparison": 0,
												"value": "\"serpent\""
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 492957764939244,
											"parameters": {
												"instance-variable": "a",
												"value": "Self.mt.MovingAngle"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 236579430448942,
											"parameters": {
												"instance-variable": "ang",
												"value": "round(Self.a-360*floor(Self.a/360))"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 919704738199074,
											"disabled": true,
											"parameters": {
												"instance-variable": "ang",
												"value": "round(Self.mt.MovingAngle-360*floor(Self.mt.MovingAngle/360))"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 100780472697910,
											"parameters": {
												"instance-variable": "angZ",
												"value": "(Self.ang>90)&(Self.ang<=270)?atan(tan(Self.ang)/aTools.isoCoeff)+180:atan(tan(Self.ang)/aTools.isoCoeff)"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 152278578305828,
											"parameters": {
												"instance-variable": "speedZ",
												"value": "Self.ang=90 | Self.ang=270 ? round(Self.speedGround*aTools.isoCoeff) : round(Self.speedGround*cos(Self.angZ)/cos(Self.ang))"
											}
										}
									],
									"sid": 868414098310376
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "ath",
									"sid": 627625205751041,
									"parameters": {
										"instance-variable": "move"
									}
								}
							],
							"actions": [
								{
									"id": "set-max-speed",
									"objectClass": "ath",
									"sid": 578520366159919,
									"behaviorType": "mt",
									"parameters": {
										"max-speed": "Self.speedZ*Self.sImpuls+10"
									}
								},
								{
									"id": "set-speed",
									"objectClass": "ath",
									"sid": 396883966272491,
									"behaviorType": "mt",
									"parameters": {
										"speed": "Self.speedZ*Self.sImpuls"
									}
								}
							],
							"sid": 653430713950478,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "ath",
											"sid": 566958962491997,
											"parameters": {
												"instance-variable": "sImpuls",
												"comparison": 4,
												"value": "1"
											}
										}
									],
									"actions": [
										{
											"id": "subtract-from-instvar",
											"objectClass": "ath",
											"sid": 453701695533619,
											"parameters": {
												"instance-variable": "sImpuls",
												"value": "0.02"
											}
										}
									],
									"sid": 905909782672142
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-instance-variable",
											"objectClass": "ath",
											"sid": 166074936891125,
											"parameters": {
												"instance-variable": "sImpuls",
												"comparison": 2,
												"value": "1"
											}
										}
									],
									"actions": [
										{
											"id": "add-to-instvar",
											"objectClass": "ath",
											"sid": 265382149788061,
											"parameters": {
												"instance-variable": "sImpuls",
												"value": "0.02"
											}
										}
									],
									"sid": 333342351732761
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-between-values",
											"objectClass": "System",
											"sid": 831946501003513,
											"parameters": {
												"value": "ath.sImpuls",
												"lower-bound": "0.96",
												"upper-bound": "1.04"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "ath",
											"sid": 612329211369218,
											"parameters": {
												"instance-variable": "sImpuls",
												"value": "1"
											}
										}
									],
									"sid": 997590997879205
								}
							]
						}
					],
					"sid": 717037420261200
				},
				{
					"eventType": "comment",
					"text": "выталкивание из препятствий",
					"background-color": [
						0.7803921568627451,
						0.8156862745098039,
						1,
						1
					]
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "pushOut",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "ath",
									"sid": 986768890341820,
									"parameters": {
										"instance-variable": "pushAbil"
									}
								}
							],
							"actions": [],
							"sid": 741172531708950,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-overlapping-another-object",
											"objectClass": "ath",
											"sid": 782112937381568,
											"parameters": {
												"object": "zoneStop"
											}
										}
									],
									"actions": [
										{
											"id": "set-position",
											"objectClass": "ath",
											"sid": 136336587520342,
											"parameters": {
												"x": "Self.X + Self.pushOut * cos(angle(zoneStop.X, zoneStop.Y, Self.X, Self.Y)) * dt",
												"y": "Self.Y + Self.pushOut * sin(angle(zoneStop.X, zoneStop.Y, Self.X, Self.Y)) * dt"
											}
										}
									],
									"sid": 529698573208036
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-overlapping-another-object",
											"objectClass": "ath",
											"sid": 810758028665046,
											"parameters": {
												"object": "zoneStopTh"
											}
										}
									],
									"actions": [
										{
											"id": "set-position",
											"objectClass": "ath",
											"sid": 150337472120816,
											"parameters": {
												"x": "Self.X + Self.pushOut*2 * cos(angle(zoneStopTh.X, zoneStopTh.Y, Self.X, Self.Y)) * dt",
												"y": "Self.Y + Self.pushOut*2 * sin(angle(zoneStopTh.X, zoneStopTh.Y, Self.X, Self.Y)) * dt"
											}
										}
									],
									"sid": 214565950405378
								}
							]
						}
					],
					"sid": 363044042581439
				}
			],
			"sid": 195975889606323
		}
	],
	"sid": 980489503117215
}